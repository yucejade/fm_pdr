<html><!-- Created using the cpp_pretty_printer from the dlib C++ library.  See http://dlib.net for updates. --><head><title>dlib C++ Library - cast.h</title></head><body bgcolor='white'><pre>
<font color='#009900'>/*
    pybind11/cast.h: Partial template specializations to cast between
    C++ and Python types

    Copyright (c) 2016 Wenzel Jakob &lt;wenzel.jakob@epfl.ch&gt;

    All rights reserved. Use of this source code is governed by a
    BSD-style license that can be found in the LICENSE file.
*/</font>

<font color='#0000FF'>#pragma</font> once

<font color='#0000FF'>#include</font> "<a style='text-decoration:none' href='detail/common.h.html'>detail/common.h</a>"
<font color='#0000FF'>#include</font> "<a style='text-decoration:none' href='detail/descr.h.html'>detail/descr.h</a>"
<font color='#0000FF'>#include</font> "<a style='text-decoration:none' href='detail/type_caster_base.h.html'>detail/type_caster_base.h</a>"
<font color='#0000FF'>#include</font> "<a style='text-decoration:none' href='detail/typeid.h.html'>detail/typeid.h</a>"
<font color='#0000FF'>#include</font> "<a style='text-decoration:none' href='pytypes.h.html'>pytypes.h</a>"

<font color='#0000FF'>#include</font> <font color='#5555FF'>&lt;</font>array<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>#include</font> <font color='#5555FF'>&lt;</font>cstring<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>#include</font> <font color='#5555FF'>&lt;</font>functional<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>#include</font> <font color='#5555FF'>&lt;</font>iosfwd<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>#include</font> <font color='#5555FF'>&lt;</font>iterator<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>#include</font> <font color='#5555FF'>&lt;</font>memory<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>#include</font> <font color='#5555FF'>&lt;</font>string<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>#include</font> <font color='#5555FF'>&lt;</font>tuple<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>#include</font> <font color='#5555FF'>&lt;</font>type_traits<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>#include</font> <font color='#5555FF'>&lt;</font>utility<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>#include</font> <font color='#5555FF'>&lt;</font>vector<font color='#5555FF'>&gt;</font>

<b><a name='PYBIND11_NAMESPACE_BEGIN'></a>PYBIND11_NAMESPACE_BEGIN</b><font face='Lucida Console'>(</font>PYBIND11_NAMESPACE<font face='Lucida Console'>)</font>

<b><a name='PYBIND11_WARNING_DISABLE_MSVC'></a>PYBIND11_WARNING_DISABLE_MSVC</b><font face='Lucida Console'>(</font><font color='#979000'>4127</font><font face='Lucida Console'>)</font>

<b><a name='PYBIND11_NAMESPACE_BEGIN'></a>PYBIND11_NAMESPACE_BEGIN</b><font face='Lucida Console'>(</font>detail<font face='Lucida Console'>)</font>

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> type, <font color='#0000FF'>typename</font> SFINAE <font color='#5555FF'>=</font> <font color='#0000FF'><u>void</u></font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>class</font> <b><a name='type_caster'></a>type_caster</b> : <font color='#0000FF'>public</font> type_caster_base<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font> <b>{</b><b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> type<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>using</font> make_caster <font color='#5555FF'>=</font> type_caster<font color='#5555FF'>&lt;</font>intrinsic_t<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>;

<font color='#009900'>// Shortcut for calling a caster's `cast_op_type` cast operator for casting a type_caster to a T
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>typename</font> make_caster<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::<font color='#0000FF'>template</font> cast_op_type<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font> <b><a name='cast_op'></a>cast_op</b><font face='Lucida Console'>(</font>make_caster<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font> <font color='#5555FF'>&amp;</font>caster<font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>using</font> result_t <font color='#5555FF'>=</font> <font color='#0000FF'>typename</font> make_caster<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::<font color='#0000FF'>template</font> cast_op_type<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>; <font color='#009900'>// See PR #4893
</font>    <font color='#0000FF'>return</font> caster.<font color='#0000FF'>operator</font> <font color='#BB00BB'>result_t</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
<b>}</b>
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>typename</font> make_caster<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::<font color='#0000FF'>template</font> cast_op_type<font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> std::add_rvalue_reference<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::type<font color='#5555FF'>&gt;</font>
<b><a name='cast_op'></a>cast_op</b><font face='Lucida Console'>(</font>make_caster<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>caster<font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>using</font> result_t <font color='#5555FF'>=</font> <font color='#0000FF'>typename</font> make_caster<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::<font color='#0000FF'>template</font> cast_op_type<font color='#5555FF'>&lt;</font>
        <font color='#0000FF'>typename</font> std::add_rvalue_reference<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::type<font color='#5555FF'>&gt;</font>; <font color='#009900'>// See PR #4893
</font>    <font color='#0000FF'>return</font> std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font>caster<font face='Lucida Console'>)</font>.<font color='#0000FF'>operator</font> <font color='#BB00BB'>result_t</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
<b>}</b>

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> type<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>class</font> <b><a name='type_caster'></a>type_caster</b><font color='#5555FF'>&lt;</font>std::reference_wrapper<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font> <b>{</b>
<font color='#0000FF'>private</font>:
    <font color='#0000FF'>using</font> caster_t <font color='#5555FF'>=</font> make_caster<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font>;
    caster_t subcaster;
    <font color='#0000FF'>using</font> reference_t <font color='#5555FF'>=</font> type <font color='#5555FF'>&amp;</font>;
    <font color='#0000FF'>using</font> subcaster_cast_op_type <font color='#5555FF'>=</font> <font color='#0000FF'>typename</font> caster_t::<font color='#0000FF'>template</font> cast_op_type<font color='#5555FF'>&lt;</font>reference_t<font color='#5555FF'>&gt;</font>;

    <b><a name='static_assert'></a>static_assert</b><font face='Lucida Console'>(</font>
        std::is_same<font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> std::remove_const<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font>::type <font color='#5555FF'>&amp;</font>, subcaster_cast_op_type<font color='#5555FF'>&gt;</font>::value
            <font color='#5555FF'>|</font><font color='#5555FF'>|</font> std::is_same<font color='#5555FF'>&lt;</font>reference_t, subcaster_cast_op_type<font color='#5555FF'>&gt;</font>::value,
        "<font color='#CC0000'>std::reference_wrapper&lt;T&gt; caster requires T to have a caster with an </font>"
        "<font color='#CC0000'>`operator T &amp;()` or `operator const T &amp;()`</font>"<font face='Lucida Console'>)</font>;

<font color='#0000FF'>public</font>:
    <font color='#0000FF'><u>bool</u></font> <b><a name='load'></a>load</b><font face='Lucida Console'>(</font>handle src, <font color='#0000FF'><u>bool</u></font> convert<font face='Lucida Console'>)</font> <b>{</b> <font color='#0000FF'>return</font> subcaster.<font color='#BB00BB'>load</font><font face='Lucida Console'>(</font>src, convert<font face='Lucida Console'>)</font>; <b>}</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> caster_t::name;
    <font color='#0000FF'>static</font> handle
    <b><a name='cast'></a>cast</b><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> std::reference_wrapper<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font> <font color='#5555FF'>&amp;</font>src, return_value_policy policy, handle parent<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#009900'>// It is definitely wrong to take ownership of this pointer, so mask that rvp
</font>        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>policy <font color='#5555FF'>=</font><font color='#5555FF'>=</font> return_value_policy::take_ownership
            <font color='#5555FF'>|</font><font color='#5555FF'>|</font> policy <font color='#5555FF'>=</font><font color='#5555FF'>=</font> return_value_policy::automatic<font face='Lucida Console'>)</font> <b>{</b>
            policy <font color='#5555FF'>=</font> return_value_policy::automatic_reference;
        <b>}</b>
        <font color='#0000FF'>return</font> caster_t::<font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font><font color='#5555FF'>&amp;</font>src.<font color='#BB00BB'>get</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>, policy, parent<font face='Lucida Console'>)</font>;
    <b>}</b>
    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'>using</font> cast_op_type <font color='#5555FF'>=</font> std::reference_wrapper<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font>;
    <font color='#0000FF'>explicit</font> <b><a name='operator'></a>operator</b> std::reference_wrapper<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <b>{</b> <font color='#0000FF'>return</font> cast_op<font color='#5555FF'>&lt;</font>type <font color='#5555FF'>&amp;</font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>subcaster<font face='Lucida Console'>)</font>; <b>}</b>
<b>}</b>;

<font color='#0000FF'>#define</font> PYBIND11_TYPE_CASTER<font face='Lucida Console'>(</font>type, py_name<font face='Lucida Console'>)</font>                                                       \
<font color='#0000FF'>protected</font>:                                                                                        \
    type value;                                                                                   \
                                                                                                  \
<font color='#0000FF'>public</font>:                                                                                           \
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> py_name;                                                         \
    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T_,                                                                        \
              ::pybind11::detail::enable_if_t<font color='#5555FF'>&lt;</font>                                                    \
                  std::is_same<font color='#5555FF'>&lt;</font>type, ::pybind11::detail::remove_cv_t<font color='#5555FF'>&lt;</font>T_<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>::value,                 \
                  <font color='#0000FF'><u>int</u></font><font color='#5555FF'>&gt;</font>                                                                            \
              <font color='#5555FF'>=</font> <font color='#979000'>0</font><font color='#5555FF'>&gt;</font>                                                                                \
    <font color='#0000FF'>static</font> ::pybind11::handle <b><a name='cast'></a>cast</b><font face='Lucida Console'>(</font>                                                               \
        T_ <font color='#5555FF'>*</font>src, ::pybind11::return_value_policy policy, ::pybind11::handle parent<font face='Lucida Console'>)</font> <b>{</b>             \
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>src<font face='Lucida Console'>)</font>                                                                                 \
            <font color='#0000FF'>return</font> ::pybind11::<font color='#BB00BB'>none</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>.<font color='#BB00BB'>release</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;                                                  \
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>policy <font color='#5555FF'>=</font><font color='#5555FF'>=</font> ::pybind11::return_value_policy::take_ownership<font face='Lucida Console'>)</font> <b>{</b>                          \
            <font color='#0000FF'>auto</font> h <font color='#5555FF'>=</font> <font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font>std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font><font color='#5555FF'>*</font>src<font face='Lucida Console'>)</font>, policy, parent<font face='Lucida Console'>)</font>;                                       \
            <font color='#0000FF'>delete</font> src;                                                                           \
            <font color='#0000FF'>return</font> h;                                                                             \
        <b>}</b>                                                                                         \
        <font color='#0000FF'>return</font> <font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font><font color='#5555FF'>*</font>src, policy, parent<font face='Lucida Console'>)</font>;                                                        \
    <b>}</b>                                                                                             \
    <b><a name='operator'></a>operator</b> type <font color='#5555FF'>*</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <b>{</b> <font color='#0000FF'>return</font> <font color='#5555FF'>&amp;</font>value; <b>}</b>               <font color='#009900'>/* NOLINT(bugprone-macro-parentheses) */</font>   \
    <b><a name='operator'></a>operator</b> type <font color='#5555FF'>&amp;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <b>{</b> <font color='#0000FF'>return</font> value; <b>}</b>                <font color='#009900'>/* NOLINT(bugprone-macro-parentheses) */</font>   \
    <b><a name='operator'></a>operator</b> type <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <b>{</b> <font color='#0000FF'>return</font> std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font>value<font face='Lucida Console'>)</font>; <b>}</b> <font color='#009900'>/* NOLINT(bugprone-macro-parentheses) */</font>   \
    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T_<font color='#5555FF'>&gt;</font>                                                                        \
    <font color='#0000FF'>using</font> cast_op_type <font color='#5555FF'>=</font> ::pybind11::detail::movable_cast_op_type<font color='#5555FF'>&lt;</font>T_<font color='#5555FF'>&gt;</font>

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> CharT<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>using</font> is_std_char_type <font color='#5555FF'>=</font> any_of<font color='#5555FF'>&lt;</font>std::is_same<font color='#5555FF'>&lt;</font>CharT, <font color='#0000FF'><u>char</u></font><font color='#5555FF'>&gt;</font>, <font color='#009900'>/* std::string */</font>
<font color='#0000FF'>#if</font> defined<font face='Lucida Console'>(</font>PYBIND11_HAS_U8STRING<font face='Lucida Console'>)</font>
                                std::is_same<font color='#5555FF'>&lt;</font>CharT, char8_t<font color='#5555FF'>&gt;</font>, <font color='#009900'>/* std::u8string */</font>
<font color='#0000FF'>#endif</font>
                                std::is_same<font color='#5555FF'>&lt;</font>CharT, char16_t<font color='#5555FF'>&gt;</font>, <font color='#009900'>/* std::u16string */</font>
                                std::is_same<font color='#5555FF'>&lt;</font>CharT, char32_t<font color='#5555FF'>&gt;</font>, <font color='#009900'>/* std::u32string */</font>
                                std::is_same<font color='#5555FF'>&lt;</font>CharT, <font color='#0000FF'><u>wchar_t</u></font><font color='#5555FF'>&gt;</font>   <font color='#009900'>/* std::wstring */</font>
                                <font color='#5555FF'>&gt;</font>;

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='type_caster'></a>type_caster</b><font color='#5555FF'>&lt;</font>T, enable_if_t<font color='#5555FF'>&lt;</font>std::is_arithmetic<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <font color='#5555FF'>!</font>is_std_char_type<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>using</font> _py_type_0 <font color='#5555FF'>=</font> conditional_t<font color='#5555FF'>&lt;</font><font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font>T<font face='Lucida Console'>)</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>=</font> <font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font><font color='#0000FF'><u>long</u></font><font face='Lucida Console'>)</font>, <font color='#0000FF'><u>long</u></font>, <font color='#0000FF'><u>long</u></font> <font color='#0000FF'><u>long</u></font><font color='#5555FF'>&gt;</font>;
    <font color='#0000FF'>using</font> _py_type_1 <font color='#5555FF'>=</font> conditional_t<font color='#5555FF'>&lt;</font>std::is_signed<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value,
                                     _py_type_0,
                                     <font color='#0000FF'>typename</font> std::make_unsigned<font color='#5555FF'>&lt;</font>_py_type_0<font color='#5555FF'>&gt;</font>::type<font color='#5555FF'>&gt;</font>;
    <font color='#0000FF'>using</font> py_type <font color='#5555FF'>=</font> conditional_t<font color='#5555FF'>&lt;</font>std::is_floating_point<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value, <font color='#0000FF'><u>double</u></font>, _py_type_1<font color='#5555FF'>&gt;</font>;

<font color='#0000FF'>public</font>:
    <font color='#0000FF'><u>bool</u></font> <b><a name='load'></a>load</b><font face='Lucida Console'>(</font>handle src, <font color='#0000FF'><u>bool</u></font> convert<font face='Lucida Console'>)</font> <b>{</b>
        py_type py_value;

        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>src<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
        <b>}</b>

<font color='#0000FF'>#if</font> <font color='#5555FF'>!</font>defined<font face='Lucida Console'>(</font>PYPY_VERSION<font face='Lucida Console'>)</font>
        <font color='#0000FF'>auto</font> index_check <font color='#5555FF'>=</font> []<font face='Lucida Console'>(</font>PyObject <font color='#5555FF'>*</font>o<font face='Lucida Console'>)</font> <b>{</b> <font color='#0000FF'>return</font> <font color='#BB00BB'>PyIndex_Check</font><font face='Lucida Console'>(</font>o<font face='Lucida Console'>)</font>; <b>}</b>;
<font color='#0000FF'>#else</font>
        <font color='#009900'>// In PyPy 7.3.3, `PyIndex_Check` is implemented by calling `__index__`,
</font>        <font color='#009900'>// while CPython only considers the existence of `nb_index`/`__index__`.
</font>        <font color='#0000FF'>auto</font> index_check <font color='#5555FF'>=</font> []<font face='Lucida Console'>(</font>PyObject <font color='#5555FF'>*</font>o<font face='Lucida Console'>)</font> <b>{</b> <font color='#0000FF'>return</font> <font color='#BB00BB'>hasattr</font><font face='Lucida Console'>(</font>o, "<font color='#CC0000'>__index__</font>"<font face='Lucida Console'>)</font>; <b>}</b>;
<font color='#0000FF'>#endif</font>

        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>std::is_floating_point<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>convert <font color='#5555FF'>|</font><font color='#5555FF'>|</font> <font color='#BB00BB'>PyFloat_Check</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
                py_value <font color='#5555FF'>=</font> <font face='Lucida Console'>(</font>py_type<font face='Lucida Console'>)</font> <font color='#BB00BB'>PyFloat_AsDouble</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
            <b>}</b> <font color='#0000FF'>else</font> <b>{</b>
                <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
            <b>}</b>
        <b>}</b> <font color='#0000FF'>else</font> <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#BB00BB'>PyFloat_Check</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>
                   <font color='#5555FF'>|</font><font color='#5555FF'>|</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>convert <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <font color='#5555FF'>!</font><font color='#BB00BB'>PYBIND11_LONG_CHECK</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <font color='#5555FF'>!</font><font color='#BB00BB'>index_check</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
        <b>}</b> <font color='#0000FF'>else</font> <b>{</b>
            handle src_or_index <font color='#5555FF'>=</font> src;
            <font color='#009900'>// PyPy: 7.3.7's 3.8 does not implement PyLong_*'s __index__ calls.
</font><font color='#0000FF'>#if</font> PY_VERSION_HEX <font color='#5555FF'>&lt;</font> <font color='#979000'>0x03080000</font> <font color='#5555FF'>|</font><font color='#5555FF'>|</font> defined<font face='Lucida Console'>(</font>PYPY_VERSION<font face='Lucida Console'>)</font>
            object index;
            <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font><font color='#BB00BB'>PYBIND11_LONG_CHECK</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b> <font color='#009900'>// So: index_check(src.ptr())
</font>                index <font color='#5555FF'>=</font> reinterpret_steal<font color='#5555FF'>&lt;</font>object<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font color='#BB00BB'>PyNumber_Index</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
                <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>index<font face='Lucida Console'>)</font> <b>{</b>
                    <font color='#BB00BB'>PyErr_Clear</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
                    <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>convert<font face='Lucida Console'>)</font>
                        <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
                <b>}</b> <font color='#0000FF'>else</font> <b>{</b>
                    src_or_index <font color='#5555FF'>=</font> index;
                <b>}</b>
            <b>}</b>
<font color='#0000FF'>#endif</font>
            <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>std::is_unsigned<font color='#5555FF'>&lt;</font>py_type<font color='#5555FF'>&gt;</font>::value<font face='Lucida Console'>)</font> <b>{</b>
                py_value <font color='#5555FF'>=</font> as_unsigned<font color='#5555FF'>&lt;</font>py_type<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>src_or_index.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
            <b>}</b> <font color='#0000FF'>else</font> <b>{</b> <font color='#009900'>// signed integer:
</font>                py_value <font color='#5555FF'>=</font> <font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font>T<font face='Lucida Console'>)</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>=</font> <font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font><font color='#0000FF'><u>long</u></font><font face='Lucida Console'>)</font>
                               ? <font face='Lucida Console'>(</font>py_type<font face='Lucida Console'>)</font> <font color='#BB00BB'>PyLong_AsLong</font><font face='Lucida Console'>(</font>src_or_index.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>
                               : <font face='Lucida Console'>(</font>py_type<font face='Lucida Console'>)</font> <font color='#BB00BB'>PYBIND11_LONG_AS_LONGLONG</font><font face='Lucida Console'>(</font>src_or_index.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
            <b>}</b>
        <b>}</b>

        <font color='#009900'>// Python API reported an error
</font>        <font color='#0000FF'><u>bool</u></font> py_err <font color='#5555FF'>=</font> py_value <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font face='Lucida Console'>(</font>py_type<font face='Lucida Console'>)</font> <font color='#5555FF'>-</font><font color='#979000'>1</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <font color='#BB00BB'>PyErr_Occurred</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;

        <font color='#009900'>// Check to see if the conversion is valid (integers should match exactly)
</font>        <font color='#009900'>// Signed/unsigned checks happen elsewhere
</font>        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>py_err
            <font color='#5555FF'>|</font><font color='#5555FF'>|</font> <font face='Lucida Console'>(</font>std::is_integral<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font>py_type<font face='Lucida Console'>)</font> <font color='#5555FF'>!</font><font color='#5555FF'>=</font> <font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font>T<font face='Lucida Console'>)</font>
                <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> py_value <font color='#5555FF'>!</font><font color='#5555FF'>=</font> <font face='Lucida Console'>(</font>py_type<font face='Lucida Console'>)</font> <font face='Lucida Console'>(</font>T<font face='Lucida Console'>)</font> py_value<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
            <font color='#BB00BB'>PyErr_Clear</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
            <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>py_err <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> convert <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <font face='Lucida Console'>(</font><font color='#BB00BB'>PyNumber_Check</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <font color='#5555FF'>!</font><font color='#5555FF'>=</font> <font color='#979000'>0</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
                <font color='#0000FF'>auto</font> tmp <font color='#5555FF'>=</font> reinterpret_steal<font color='#5555FF'>&lt;</font>object<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>std::is_floating_point<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value
                                                         ? <font color='#BB00BB'>PyNumber_Float</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>
                                                         : <font color='#BB00BB'>PyNumber_Long</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
                <font color='#BB00BB'>PyErr_Clear</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
                <font color='#0000FF'>return</font> <font color='#BB00BB'>load</font><font face='Lucida Console'>(</font>tmp, <font color='#979000'>false</font><font face='Lucida Console'>)</font>;
            <b>}</b>
            <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
        <b>}</b>

        value <font color='#5555FF'>=</font> <font face='Lucida Console'>(</font>T<font face='Lucida Console'>)</font> py_value;
        <font color='#0000FF'>return</font> <font color='#979000'>true</font>;
    <b>}</b>

    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> U <font color='#5555FF'>=</font> T<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'>static</font> <font color='#0000FF'>typename</font> std::enable_if<font color='#5555FF'>&lt;</font>std::is_floating_point<font color='#5555FF'>&lt;</font>U<font color='#5555FF'>&gt;</font>::value, handle<font color='#5555FF'>&gt;</font>::type
    <b><a name='cast'></a>cast</b><font face='Lucida Console'>(</font>U src, return_value_policy <font color='#009900'>/* policy */</font>, handle <font color='#009900'>/* parent */</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>return</font> <font color='#BB00BB'>PyFloat_FromDouble</font><font face='Lucida Console'>(</font><font face='Lucida Console'>(</font><font color='#0000FF'><u>double</u></font><font face='Lucida Console'>)</font> src<font face='Lucida Console'>)</font>;
    <b>}</b>

    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> U <font color='#5555FF'>=</font> T<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'>static</font> <font color='#0000FF'>typename</font> std::enable_if<font color='#5555FF'>&lt;</font><font color='#5555FF'>!</font>std::is_floating_point<font color='#5555FF'>&lt;</font>U<font color='#5555FF'>&gt;</font>::value <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> std::is_signed<font color='#5555FF'>&lt;</font>U<font color='#5555FF'>&gt;</font>::value
                                       <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <font face='Lucida Console'>(</font><font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font>U<font face='Lucida Console'>)</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>=</font> <font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font><font color='#0000FF'><u>long</u></font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>,
                                   handle<font color='#5555FF'>&gt;</font>::type
    <b><a name='cast'></a>cast</b><font face='Lucida Console'>(</font>U src, return_value_policy <font color='#009900'>/* policy */</font>, handle <font color='#009900'>/* parent */</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>return</font> <font color='#BB00BB'>PYBIND11_LONG_FROM_SIGNED</font><font face='Lucida Console'>(</font><font face='Lucida Console'>(</font><font color='#0000FF'><u>long</u></font><font face='Lucida Console'>)</font> src<font face='Lucida Console'>)</font>;
    <b>}</b>

    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> U <font color='#5555FF'>=</font> T<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'>static</font> <font color='#0000FF'>typename</font> std::enable_if<font color='#5555FF'>&lt;</font><font color='#5555FF'>!</font>std::is_floating_point<font color='#5555FF'>&lt;</font>U<font color='#5555FF'>&gt;</font>::value <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> std::is_unsigned<font color='#5555FF'>&lt;</font>U<font color='#5555FF'>&gt;</font>::value
                                       <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <font face='Lucida Console'>(</font><font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font>U<font face='Lucida Console'>)</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>=</font> <font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font><font color='#0000FF'><u>unsigned</u></font> <font color='#0000FF'><u>long</u></font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>,
                                   handle<font color='#5555FF'>&gt;</font>::type
    <b><a name='cast'></a>cast</b><font face='Lucida Console'>(</font>U src, return_value_policy <font color='#009900'>/* policy */</font>, handle <font color='#009900'>/* parent */</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>return</font> <font color='#BB00BB'>PYBIND11_LONG_FROM_UNSIGNED</font><font face='Lucida Console'>(</font><font face='Lucida Console'>(</font><font color='#0000FF'><u>unsigned</u></font> <font color='#0000FF'><u>long</u></font><font face='Lucida Console'>)</font> src<font face='Lucida Console'>)</font>;
    <b>}</b>

    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> U <font color='#5555FF'>=</font> T<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'>static</font> <font color='#0000FF'>typename</font> std::enable_if<font color='#5555FF'>&lt;</font><font color='#5555FF'>!</font>std::is_floating_point<font color='#5555FF'>&lt;</font>U<font color='#5555FF'>&gt;</font>::value <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> std::is_signed<font color='#5555FF'>&lt;</font>U<font color='#5555FF'>&gt;</font>::value
                                       <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <font face='Lucida Console'>(</font><font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font>U<font face='Lucida Console'>)</font> <font color='#5555FF'>&gt;</font> <font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font><font color='#0000FF'><u>long</u></font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>,
                                   handle<font color='#5555FF'>&gt;</font>::type
    <b><a name='cast'></a>cast</b><font face='Lucida Console'>(</font>U src, return_value_policy <font color='#009900'>/* policy */</font>, handle <font color='#009900'>/* parent */</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>return</font> <font color='#BB00BB'>PyLong_FromLongLong</font><font face='Lucida Console'>(</font><font face='Lucida Console'>(</font><font color='#0000FF'><u>long</u></font> <font color='#0000FF'><u>long</u></font><font face='Lucida Console'>)</font> src<font face='Lucida Console'>)</font>;
    <b>}</b>

    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> U <font color='#5555FF'>=</font> T<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'>static</font> <font color='#0000FF'>typename</font> std::enable_if<font color='#5555FF'>&lt;</font><font color='#5555FF'>!</font>std::is_floating_point<font color='#5555FF'>&lt;</font>U<font color='#5555FF'>&gt;</font>::value <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> std::is_unsigned<font color='#5555FF'>&lt;</font>U<font color='#5555FF'>&gt;</font>::value
                                       <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <font face='Lucida Console'>(</font><font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font>U<font face='Lucida Console'>)</font> <font color='#5555FF'>&gt;</font> <font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font><font color='#0000FF'><u>unsigned</u></font> <font color='#0000FF'><u>long</u></font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>,
                                   handle<font color='#5555FF'>&gt;</font>::type
    <b><a name='cast'></a>cast</b><font face='Lucida Console'>(</font>U src, return_value_policy <font color='#009900'>/* policy */</font>, handle <font color='#009900'>/* parent */</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>return</font> <font color='#BB00BB'>PyLong_FromUnsignedLongLong</font><font face='Lucida Console'>(</font><font face='Lucida Console'>(</font><font color='#0000FF'><u>unsigned</u></font> <font color='#0000FF'><u>long</u></font> <font color='#0000FF'><u>long</u></font><font face='Lucida Console'>)</font> src<font face='Lucida Console'>)</font>;
    <b>}</b>

    <b><a name='PYBIND11_TYPE_CASTER'></a>PYBIND11_TYPE_CASTER</b><font face='Lucida Console'>(</font>T, const_name<font color='#5555FF'>&lt;</font>std::is_integral<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>int</font>", "<font color='#CC0000'>float</font>"<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
<b>}</b>;

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='void_caster'></a>void_caster</b> <b>{</b>
<font color='#0000FF'>public</font>:
    <font color='#0000FF'><u>bool</u></font> <b><a name='load'></a>load</b><font face='Lucida Console'>(</font>handle src, <font color='#0000FF'><u>bool</u></font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>src <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> src.<font color='#BB00BB'>is_none</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>return</font> <font color='#979000'>true</font>;
        <b>}</b>
        <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
    <b>}</b>
    <font color='#0000FF'>static</font> handle <b><a name='cast'></a>cast</b><font face='Lucida Console'>(</font>T, return_value_policy <font color='#009900'>/* policy */</font>, handle <font color='#009900'>/* parent */</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>return</font> <font color='#BB00BB'>none</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>.<font color='#BB00BB'>release</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
    <b>}</b>
    <b><a name='PYBIND11_TYPE_CASTER'></a>PYBIND11_TYPE_CASTER</b><font face='Lucida Console'>(</font>T, <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>None</font>"<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
<b>}</b>;

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>class</font> <b><a name='type_caster'></a>type_caster</b><font color='#5555FF'>&lt;</font>void_type<font color='#5555FF'>&gt;</font> : <font color='#0000FF'>public</font> void_caster<font color='#5555FF'>&lt;</font>void_type<font color='#5555FF'>&gt;</font> <b>{</b><b>}</b>;

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>class</font> <b><a name='type_caster'></a>type_caster</b><font color='#5555FF'>&lt;</font><font color='#0000FF'><u>void</u></font><font color='#5555FF'>&gt;</font> : <font color='#0000FF'>public</font> type_caster<font color='#5555FF'>&lt;</font>void_type<font color='#5555FF'>&gt;</font> <b>{</b>
<font color='#0000FF'>public</font>:
    <font color='#0000FF'>using</font> type_caster<font color='#5555FF'>&lt;</font>void_type<font color='#5555FF'>&gt;</font>::cast;

    <font color='#0000FF'><u>bool</u></font> <b><a name='load'></a>load</b><font face='Lucida Console'>(</font>handle h, <font color='#0000FF'><u>bool</u></font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>h<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
        <b>}</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>h.<font color='#BB00BB'>is_none</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
            value <font color='#5555FF'>=</font> nullptr;
            <font color='#0000FF'>return</font> <font color='#979000'>true</font>;
        <b>}</b>

        <font color='#009900'>/* Check if this is a capsule */</font>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>isinstance<font color='#5555FF'>&lt;</font>capsule<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>h<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
            value <font color='#5555FF'>=</font> reinterpret_borrow<font color='#5555FF'>&lt;</font>capsule<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>h<font face='Lucida Console'>)</font>;
            <font color='#0000FF'>return</font> <font color='#979000'>true</font>;
        <b>}</b>

        <font color='#009900'>/* Check if this is a C++ type */</font>
        <font color='#0000FF'>const</font> <font color='#0000FF'>auto</font> <font color='#5555FF'>&amp;</font>bases <font color='#5555FF'>=</font> <font color='#BB00BB'>all_type_info</font><font face='Lucida Console'>(</font><font face='Lucida Console'>(</font>PyTypeObject <font color='#5555FF'>*</font><font face='Lucida Console'>)</font> type::<font color='#BB00BB'>handle_of</font><font face='Lucida Console'>(</font>h<font face='Lucida Console'>)</font>.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>bases.<font color='#BB00BB'>size</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>1</font><font face='Lucida Console'>)</font> <b>{</b> <font color='#009900'>// Only allowing loading from a single-value type
</font>            value <font color='#5555FF'>=</font> <font color='#BB00BB'>values_and_holders</font><font face='Lucida Console'>(</font><font color='#0000FF'>reinterpret_cast</font><font color='#5555FF'>&lt;</font>instance <font color='#5555FF'>*</font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>h.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>.<font color='#BB00BB'>begin</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font color='#5555FF'>-</font><font color='#5555FF'>&gt;</font><font color='#BB00BB'>value_ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
            <font color='#0000FF'>return</font> <font color='#979000'>true</font>;
        <b>}</b>

        <font color='#009900'>/* Fail */</font>
        <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
    <b>}</b>

    <font color='#0000FF'>static</font> handle <b><a name='cast'></a>cast</b><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> <font color='#0000FF'><u>void</u></font> <font color='#5555FF'>*</font>ptr, return_value_policy <font color='#009900'>/* policy */</font>, handle <font color='#009900'>/* parent */</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>ptr<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>return</font> <font color='#BB00BB'>capsule</font><font face='Lucida Console'>(</font>ptr<font face='Lucida Console'>)</font>.<font color='#BB00BB'>release</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
        <b>}</b>
        <font color='#0000FF'>return</font> <font color='#BB00BB'>none</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>.<font color='#BB00BB'>release</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
    <b>}</b>

    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'>using</font> cast_op_type <font color='#5555FF'>=</font> <font color='#0000FF'><u>void</u></font> <font color='#5555FF'>*</font><font color='#5555FF'>&amp;</font>;
    <font color='#0000FF'>explicit</font> <b><a name='operator'></a>operator</b> <font color='#0000FF'><u>void</u></font> <font color='#5555FF'>*</font><font color='#5555FF'>&amp;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <b>{</b> <font color='#0000FF'>return</font> value; <b>}</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <b><a name='const_name'></a>const_name</b><font face='Lucida Console'>(</font>"<font color='#CC0000'>capsule</font>"<font face='Lucida Console'>)</font>;

<font color='#0000FF'>private</font>:
    <font color='#0000FF'><u>void</u></font> <font color='#5555FF'>*</font>value <font color='#5555FF'>=</font> nullptr;
<b>}</b>;

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>class</font> <b><a name='type_caster'></a>type_caster</b><font color='#5555FF'>&lt;</font>std::nullptr_t<font color='#5555FF'>&gt;</font> : <font color='#0000FF'>public</font> void_caster<font color='#5555FF'>&lt;</font>std::nullptr_t<font color='#5555FF'>&gt;</font> <b>{</b><b>}</b>;

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>class</font> <b><a name='type_caster'></a>type_caster</b><font color='#5555FF'>&lt;</font><font color='#0000FF'><u>bool</u></font><font color='#5555FF'>&gt;</font> <b>{</b>
<font color='#0000FF'>public</font>:
    <font color='#0000FF'><u>bool</u></font> <b><a name='load'></a>load</b><font face='Lucida Console'>(</font>handle src, <font color='#0000FF'><u>bool</u></font> convert<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>src<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
        <b>}</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>=</font><font color='#5555FF'>=</font> Py_True<font face='Lucida Console'>)</font> <b>{</b>
            value <font color='#5555FF'>=</font> <font color='#979000'>true</font>;
            <font color='#0000FF'>return</font> <font color='#979000'>true</font>;
        <b>}</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>=</font><font color='#5555FF'>=</font> Py_False<font face='Lucida Console'>)</font> <b>{</b>
            value <font color='#5555FF'>=</font> <font color='#979000'>false</font>;
            <font color='#0000FF'>return</font> <font color='#979000'>true</font>;
        <b>}</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>convert <font color='#5555FF'>|</font><font color='#5555FF'>|</font> <font color='#BB00BB'>is_numpy_bool</font><font face='Lucida Console'>(</font>src<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
            <font color='#009900'>// (allow non-implicit conversion for numpy booleans), use strncmp
</font>            <font color='#009900'>// since NumPy 1.x had an additional trailing underscore.
</font>
            Py_ssize_t res <font color='#5555FF'>=</font> <font color='#5555FF'>-</font><font color='#979000'>1</font>;
            <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>src.<font color='#BB00BB'>is_none</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
                res <font color='#5555FF'>=</font> <font color='#979000'>0</font>; <font color='#009900'>// None is implicitly converted to False
</font>            <b>}</b>
<font color='#0000FF'>#if</font> defined<font face='Lucida Console'>(</font>PYPY_VERSION<font face='Lucida Console'>)</font>
            <font color='#009900'>// On PyPy, check that "__bool__" attr exists
</font>            <font color='#0000FF'>else</font> <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#BB00BB'>hasattr</font><font face='Lucida Console'>(</font>src, PYBIND11_BOOL_ATTR<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
                res <font color='#5555FF'>=</font> <font color='#BB00BB'>PyObject_IsTrue</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
            <b>}</b>
<font color='#0000FF'>#else</font>
            <font color='#009900'>// Alternate approach for CPython: this does the same as the above, but optimized
</font>            <font color='#009900'>// using the CPython API so as to avoid an unneeded attribute lookup.
</font>            <font color='#0000FF'>else</font> <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#0000FF'>auto</font> <font color='#5555FF'>*</font>tp_as_number <font color='#5555FF'>=</font> src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font color='#5555FF'>-</font><font color='#5555FF'>&gt;</font>ob_type<font color='#5555FF'>-</font><font color='#5555FF'>&gt;</font>tp_as_number<font face='Lucida Console'>)</font> <b>{</b>
                <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#BB00BB'>PYBIND11_NB_BOOL</font><font face='Lucida Console'>(</font>tp_as_number<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
                    res <font color='#5555FF'>=</font> <font face='Lucida Console'>(</font><font color='#5555FF'>*</font><font color='#BB00BB'>PYBIND11_NB_BOOL</font><font face='Lucida Console'>(</font>tp_as_number<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
                <b>}</b>
            <b>}</b>
<font color='#0000FF'>#endif</font>
            <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>res <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>0</font> <font color='#5555FF'>|</font><font color='#5555FF'>|</font> res <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>1</font><font face='Lucida Console'>)</font> <b>{</b>
                value <font color='#5555FF'>=</font> <font face='Lucida Console'>(</font>res <font color='#5555FF'>!</font><font color='#5555FF'>=</font> <font color='#979000'>0</font><font face='Lucida Console'>)</font>;
                <font color='#0000FF'>return</font> <font color='#979000'>true</font>;
            <b>}</b>
            <font color='#BB00BB'>PyErr_Clear</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
        <b>}</b>
        <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
    <b>}</b>
    <font color='#0000FF'>static</font> handle <b><a name='cast'></a>cast</b><font face='Lucida Console'>(</font><font color='#0000FF'><u>bool</u></font> src, return_value_policy <font color='#009900'>/* policy */</font>, handle <font color='#009900'>/* parent */</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>return</font> <font color='#BB00BB'>handle</font><font face='Lucida Console'>(</font>src ? Py_True : Py_False<font face='Lucida Console'>)</font>.<font color='#BB00BB'>inc_ref</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
    <b>}</b>
    <b><a name='PYBIND11_TYPE_CASTER'></a>PYBIND11_TYPE_CASTER</b><font face='Lucida Console'>(</font><font color='#0000FF'><u>bool</u></font>, <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>bool</font>"<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;

<font color='#0000FF'>private</font>:
    <font color='#009900'>// Test if an object is a NumPy boolean (without fetching the type).
</font>    <font color='#0000FF'>static</font> <font color='#0000FF'>inline</font> <font color='#0000FF'><u>bool</u></font> <b><a name='is_numpy_bool'></a>is_numpy_bool</b><font face='Lucida Console'>(</font>handle object<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>const</font> <font color='#0000FF'><u>char</u></font> <font color='#5555FF'>*</font>type_name <font color='#5555FF'>=</font> <font color='#BB00BB'>Py_TYPE</font><font face='Lucida Console'>(</font>object.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font color='#5555FF'>-</font><font color='#5555FF'>&gt;</font>tp_name;
        <font color='#009900'>// Name changed to `numpy.bool` in NumPy 2, `numpy.bool_` is needed for 1.x support
</font>        <font color='#0000FF'>return</font> std::<font color='#BB00BB'>strcmp</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>numpy.bool</font>", type_name<font face='Lucida Console'>)</font> <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>0</font>
               <font color='#5555FF'>|</font><font color='#5555FF'>|</font> std::<font color='#BB00BB'>strcmp</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>numpy.bool_</font>", type_name<font face='Lucida Console'>)</font> <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>0</font>;
    <b>}</b>
<b>}</b>;

<font color='#009900'>// Helper class for UTF-{8,16,32} C++ stl strings:
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> StringType, <font color='#0000FF'><u>bool</u></font> IsView <font color='#5555FF'>=</font> <font color='#979000'>false</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='string_caster'></a>string_caster</b> <b>{</b>
    <font color='#0000FF'>using</font> CharT <font color='#5555FF'>=</font> <font color='#0000FF'>typename</font> StringType::value_type;

    <font color='#009900'>// Simplify life by being able to assume standard char sizes (the standard only guarantees
</font>    <font color='#009900'>// minimums, but Python requires exact sizes)
</font>    <b><a name='static_assert'></a>static_assert</b><font face='Lucida Console'>(</font><font color='#5555FF'>!</font>std::is_same<font color='#5555FF'>&lt;</font>CharT, <font color='#0000FF'><u>char</u></font><font color='#5555FF'>&gt;</font>::value <font color='#5555FF'>|</font><font color='#5555FF'>|</font> <font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font>CharT<font face='Lucida Console'>)</font> <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>1</font>,
                  "<font color='#CC0000'>Unsupported char size != 1</font>"<font face='Lucida Console'>)</font>;
<font color='#0000FF'>#if</font> defined<font face='Lucida Console'>(</font>PYBIND11_HAS_U8STRING<font face='Lucida Console'>)</font>
    <b><a name='static_assert'></a>static_assert</b><font face='Lucida Console'>(</font><font color='#5555FF'>!</font>std::is_same<font color='#5555FF'>&lt;</font>CharT, char8_t<font color='#5555FF'>&gt;</font>::value <font color='#5555FF'>|</font><font color='#5555FF'>|</font> <font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font>CharT<font face='Lucida Console'>)</font> <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>1</font>,
                  "<font color='#CC0000'>Unsupported char8_t size != 1</font>"<font face='Lucida Console'>)</font>;
<font color='#0000FF'>#endif</font>
    <b><a name='static_assert'></a>static_assert</b><font face='Lucida Console'>(</font><font color='#5555FF'>!</font>std::is_same<font color='#5555FF'>&lt;</font>CharT, char16_t<font color='#5555FF'>&gt;</font>::value <font color='#5555FF'>|</font><font color='#5555FF'>|</font> <font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font>CharT<font face='Lucida Console'>)</font> <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>2</font>,
                  "<font color='#CC0000'>Unsupported char16_t size != 2</font>"<font face='Lucida Console'>)</font>;
    <b><a name='static_assert'></a>static_assert</b><font face='Lucida Console'>(</font><font color='#5555FF'>!</font>std::is_same<font color='#5555FF'>&lt;</font>CharT, char32_t<font color='#5555FF'>&gt;</font>::value <font color='#5555FF'>|</font><font color='#5555FF'>|</font> <font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font>CharT<font face='Lucida Console'>)</font> <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>4</font>,
                  "<font color='#CC0000'>Unsupported char32_t size != 4</font>"<font face='Lucida Console'>)</font>;
    <font color='#009900'>// wchar_t can be either 16 bits (Windows) or 32 (everywhere else)
</font>    <b><a name='static_assert'></a>static_assert</b><font face='Lucida Console'>(</font><font color='#5555FF'>!</font>std::is_same<font color='#5555FF'>&lt;</font>CharT, <font color='#0000FF'><u>wchar_t</u></font><font color='#5555FF'>&gt;</font>::value <font color='#5555FF'>|</font><font color='#5555FF'>|</font> <font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font>CharT<font face='Lucida Console'>)</font> <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>2</font> <font color='#5555FF'>|</font><font color='#5555FF'>|</font> <font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font>CharT<font face='Lucida Console'>)</font> <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>4</font>,
                  "<font color='#CC0000'>Unsupported wchar_t size != 2/4</font>"<font face='Lucida Console'>)</font>;
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'><u>size_t</u></font> UTF_N <font color='#5555FF'>=</font> <font color='#979000'>8</font> <font color='#5555FF'>*</font> <font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font>CharT<font face='Lucida Console'>)</font>;

    <font color='#0000FF'><u>bool</u></font> <b><a name='load'></a>load</b><font face='Lucida Console'>(</font>handle src, <font color='#0000FF'><u>bool</u></font><font face='Lucida Console'>)</font> <b>{</b>
        handle load_src <font color='#5555FF'>=</font> src;
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>src<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
        <b>}</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font><font color='#BB00BB'>PyUnicode_Check</font><font face='Lucida Console'>(</font>load_src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>return</font> <font color='#BB00BB'>load_raw</font><font face='Lucida Console'>(</font>load_src<font face='Lucida Console'>)</font>;
        <b>}</b>

        <font color='#009900'>// For UTF-8 we avoid the need for a temporary `bytes` object by using
</font>        <font color='#009900'>// `PyUnicode_AsUTF8AndSize`.
</font>        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>UTF_N <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>8</font><font face='Lucida Console'>)</font> <b>{</b>
            Py_ssize_t size <font color='#5555FF'>=</font> <font color='#5555FF'>-</font><font color='#979000'>1</font>;
            <font color='#0000FF'>const</font> <font color='#0000FF'>auto</font> <font color='#5555FF'>*</font>buffer
                <font color='#5555FF'>=</font> <font color='#0000FF'>reinterpret_cast</font><font color='#5555FF'>&lt;</font><font color='#0000FF'>const</font> CharT <font color='#5555FF'>*</font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font color='#BB00BB'>PyUnicode_AsUTF8AndSize</font><font face='Lucida Console'>(</font>load_src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>, <font color='#5555FF'>&amp;</font>size<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
            <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>buffer<font face='Lucida Console'>)</font> <b>{</b>
                <font color='#BB00BB'>PyErr_Clear</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
                <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
            <b>}</b>
            value <font color='#5555FF'>=</font> <font color='#BB00BB'>StringType</font><font face='Lucida Console'>(</font>buffer, <font color='#0000FF'>static_cast</font><font color='#5555FF'>&lt;</font><font color='#0000FF'><u>size_t</u></font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>size<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
            <font color='#0000FF'>return</font> <font color='#979000'>true</font>;
        <b>}</b>

        <font color='#0000FF'>auto</font> utfNbytes
            <font color='#5555FF'>=</font> reinterpret_steal<font color='#5555FF'>&lt;</font>object<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font color='#BB00BB'>PyUnicode_AsEncodedString</font><font face='Lucida Console'>(</font>load_src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>,
                                                                  UTF_N <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>8</font>    ? "<font color='#CC0000'>utf-8</font>"
                                                                  : UTF_N <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>16</font> ? "<font color='#CC0000'>utf-16</font>"
                                                                                : "<font color='#CC0000'>utf-32</font>",
                                                                  nullptr<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>utfNbytes<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#BB00BB'>PyErr_Clear</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
            <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
        <b>}</b>

        <font color='#0000FF'>const</font> <font color='#0000FF'>auto</font> <font color='#5555FF'>*</font>buffer
            <font color='#5555FF'>=</font> <font color='#0000FF'>reinterpret_cast</font><font color='#5555FF'>&lt;</font><font color='#0000FF'>const</font> CharT <font color='#5555FF'>*</font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font color='#BB00BB'>PYBIND11_BYTES_AS_STRING</font><font face='Lucida Console'>(</font>utfNbytes.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
        <font color='#0000FF'><u>size_t</u></font> length <font color='#5555FF'>=</font> <font face='Lucida Console'>(</font><font color='#0000FF'><u>size_t</u></font><font face='Lucida Console'>)</font> <font color='#BB00BB'>PYBIND11_BYTES_SIZE</font><font face='Lucida Console'>(</font>utfNbytes.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <font color='#5555FF'>/</font> <font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font>CharT<font face='Lucida Console'>)</font>;
        <font color='#009900'>// Skip BOM for UTF-16/32
</font>        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>UTF_N <font color='#5555FF'>&gt;</font> <font color='#979000'>8</font><font face='Lucida Console'>)</font> <b>{</b>
            buffer<font color='#5555FF'>+</font><font color='#5555FF'>+</font>;
            length<font color='#5555FF'>-</font><font color='#5555FF'>-</font>;
        <b>}</b>
        value <font color='#5555FF'>=</font> <font color='#BB00BB'>StringType</font><font face='Lucida Console'>(</font>buffer, length<font face='Lucida Console'>)</font>;

        <font color='#009900'>// If we're loading a string_view we need to keep the encoded Python object alive:
</font>        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>IsView<font face='Lucida Console'>)</font> <b>{</b>
            loader_life_support::<font color='#BB00BB'>add_patient</font><font face='Lucida Console'>(</font>utfNbytes<font face='Lucida Console'>)</font>;
        <b>}</b>

        <font color='#0000FF'>return</font> <font color='#979000'>true</font>;
    <b>}</b>

    <font color='#0000FF'>static</font> handle
    <b><a name='cast'></a>cast</b><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> StringType <font color='#5555FF'>&amp;</font>src, return_value_policy <font color='#009900'>/* policy */</font>, handle <font color='#009900'>/* parent */</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>const</font> <font color='#0000FF'><u>char</u></font> <font color='#5555FF'>*</font>buffer <font color='#5555FF'>=</font> <font color='#0000FF'>reinterpret_cast</font><font color='#5555FF'>&lt;</font><font color='#0000FF'>const</font> <font color='#0000FF'><u>char</u></font> <font color='#5555FF'>*</font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>data</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
        <font color='#0000FF'>auto</font> nbytes <font color='#5555FF'>=</font> <font color='#BB00BB'>ssize_t</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>size</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>*</font> <font color='#0000FF'>sizeof</font><font face='Lucida Console'>(</font>CharT<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
        handle s <font color='#5555FF'>=</font> <font color='#BB00BB'>decode_utfN</font><font face='Lucida Console'>(</font>buffer, nbytes<font face='Lucida Console'>)</font>;
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>s<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>throw</font> <font color='#BB00BB'>error_already_set</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
        <b>}</b>
        <font color='#0000FF'>return</font> s;
    <b>}</b>

    <b><a name='PYBIND11_TYPE_CASTER'></a>PYBIND11_TYPE_CASTER</b><font face='Lucida Console'>(</font>StringType, <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>PYBIND11_STRING_NAME<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;

<font color='#0000FF'>private</font>:
    <font color='#0000FF'>static</font> handle <b><a name='decode_utfN'></a>decode_utfN</b><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> <font color='#0000FF'><u>char</u></font> <font color='#5555FF'>*</font>buffer, ssize_t nbytes<font face='Lucida Console'>)</font> <b>{</b>
<font color='#0000FF'>#if</font> <font color='#5555FF'>!</font>defined<font face='Lucida Console'>(</font>PYPY_VERSION<font face='Lucida Console'>)</font>
        <font color='#0000FF'>return</font> UTF_N <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>8</font>    ? <font color='#BB00BB'>PyUnicode_DecodeUTF8</font><font face='Lucida Console'>(</font>buffer, nbytes, nullptr<font face='Lucida Console'>)</font>
               : UTF_N <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>16</font> ? <font color='#BB00BB'>PyUnicode_DecodeUTF16</font><font face='Lucida Console'>(</font>buffer, nbytes, nullptr, nullptr<font face='Lucida Console'>)</font>
                             : <font color='#BB00BB'>PyUnicode_DecodeUTF32</font><font face='Lucida Console'>(</font>buffer, nbytes, nullptr, nullptr<font face='Lucida Console'>)</font>;
<font color='#0000FF'>#else</font>
        <font color='#009900'>// PyPy segfaults when on PyUnicode_DecodeUTF16 (and possibly on PyUnicode_DecodeUTF32 as
</font>        <font color='#009900'>// well), so bypass the whole thing by just passing the encoding as a string value, which
</font>        <font color='#009900'>// works properly:
</font>        <font color='#0000FF'>return</font> <font color='#BB00BB'>PyUnicode_Decode</font><font face='Lucida Console'>(</font>buffer,
                                nbytes,
                                UTF_N <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>8</font>    ? "<font color='#CC0000'>utf-8</font>"
                                : UTF_N <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>16</font> ? "<font color='#CC0000'>utf-16</font>"
                                              : "<font color='#CC0000'>utf-32</font>",
                                nullptr<font face='Lucida Console'>)</font>;
<font color='#0000FF'>#endif</font>
    <b>}</b>

    <font color='#009900'>// When loading into a std::string or char*, accept a bytes/bytearray object as-is (i.e.
</font>    <font color='#009900'>// without any encoding/decoding attempt).  For other C++ char sizes this is a no-op.
</font>    <font color='#009900'>// which supports loading a unicode from a str, doesn't take this path.
</font>    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> C <font color='#5555FF'>=</font> CharT<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'><u>bool</u></font> <b><a name='load_raw'></a>load_raw</b><font face='Lucida Console'>(</font>enable_if_t<font color='#5555FF'>&lt;</font>std::is_same<font color='#5555FF'>&lt;</font>C, <font color='#0000FF'><u>char</u></font><font color='#5555FF'>&gt;</font>::value, handle<font color='#5555FF'>&gt;</font> src<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#BB00BB'>PYBIND11_BYTES_CHECK</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
            <font color='#009900'>// We were passed raw bytes; accept it into a std::string or char*
</font>            <font color='#009900'>// without any encoding attempt.
</font>            <font color='#0000FF'>const</font> <font color='#0000FF'><u>char</u></font> <font color='#5555FF'>*</font>bytes <font color='#5555FF'>=</font> <font color='#BB00BB'>PYBIND11_BYTES_AS_STRING</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
            <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>bytes<font face='Lucida Console'>)</font> <b>{</b>
                <font color='#BB00BB'>pybind11_fail</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Unexpected PYBIND11_BYTES_AS_STRING() failure.</font>"<font face='Lucida Console'>)</font>;
            <b>}</b>
            value <font color='#5555FF'>=</font> <font color='#BB00BB'>StringType</font><font face='Lucida Console'>(</font>bytes, <font face='Lucida Console'>(</font><font color='#0000FF'><u>size_t</u></font><font face='Lucida Console'>)</font> <font color='#BB00BB'>PYBIND11_BYTES_SIZE</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
            <font color='#0000FF'>return</font> <font color='#979000'>true</font>;
        <b>}</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#BB00BB'>PyByteArray_Check</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
            <font color='#009900'>// We were passed a bytearray; accept it into a std::string or char*
</font>            <font color='#009900'>// without any encoding attempt.
</font>            <font color='#0000FF'>const</font> <font color='#0000FF'><u>char</u></font> <font color='#5555FF'>*</font>bytearray <font color='#5555FF'>=</font> <font color='#BB00BB'>PyByteArray_AsString</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
            <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>bytearray<font face='Lucida Console'>)</font> <b>{</b>
                <font color='#BB00BB'>pybind11_fail</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Unexpected PyByteArray_AsString() failure.</font>"<font face='Lucida Console'>)</font>;
            <b>}</b>
            value <font color='#5555FF'>=</font> <font color='#BB00BB'>StringType</font><font face='Lucida Console'>(</font>bytearray, <font face='Lucida Console'>(</font><font color='#0000FF'><u>size_t</u></font><font face='Lucida Console'>)</font> <font color='#BB00BB'>PyByteArray_Size</font><font face='Lucida Console'>(</font>src.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
            <font color='#0000FF'>return</font> <font color='#979000'>true</font>;
        <b>}</b>

        <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
    <b>}</b>

    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> C <font color='#5555FF'>=</font> CharT<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'><u>bool</u></font> <b><a name='load_raw'></a>load_raw</b><font face='Lucida Console'>(</font>enable_if_t<font color='#5555FF'>&lt;</font><font color='#5555FF'>!</font>std::is_same<font color='#5555FF'>&lt;</font>C, <font color='#0000FF'><u>char</u></font><font color='#5555FF'>&gt;</font>::value, handle<font color='#5555FF'>&gt;</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
    <b>}</b>
<b>}</b>;

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> CharT, <font color='#0000FF'>class</font> <b><a name='Traits'></a>Traits</b>, <font color='#0000FF'>class</font> <b><a name='Allocator'></a>Allocator</b><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='type_caster'></a>type_caster</b><font color='#5555FF'>&lt;</font>std::basic_string<font color='#5555FF'>&lt;</font>CharT, Traits, Allocator<font color='#5555FF'>&gt;</font>,
                   enable_if_t<font color='#5555FF'>&lt;</font>is_std_char_type<font color='#5555FF'>&lt;</font>CharT<font color='#5555FF'>&gt;</font>::value<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>
    : string_caster<font color='#5555FF'>&lt;</font>std::basic_string<font color='#5555FF'>&lt;</font>CharT, Traits, Allocator<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font> <b>{</b><b>}</b>;

<font color='#0000FF'>#ifdef</font> PYBIND11_HAS_STRING_VIEW
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> CharT, <font color='#0000FF'>class</font> <b><a name='Traits'></a>Traits</b><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='type_caster'></a>type_caster</b><font color='#5555FF'>&lt;</font>std::basic_string_view<font color='#5555FF'>&lt;</font>CharT, Traits<font color='#5555FF'>&gt;</font>,
                   enable_if_t<font color='#5555FF'>&lt;</font>is_std_char_type<font color='#5555FF'>&lt;</font>CharT<font color='#5555FF'>&gt;</font>::value<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>
    : string_caster<font color='#5555FF'>&lt;</font>std::basic_string_view<font color='#5555FF'>&lt;</font>CharT, Traits<font color='#5555FF'>&gt;</font>, <font color='#979000'>true</font><font color='#5555FF'>&gt;</font> <b>{</b><b>}</b>;
<font color='#0000FF'>#endif</font>

<font color='#009900'>// Type caster for C-style strings.  We basically use a std::string type caster, but also add the
</font><font color='#009900'>// ability to use None as a nullptr char* (which the string caster doesn't allow).
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> CharT<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='type_caster'></a>type_caster</b><font color='#5555FF'>&lt;</font>CharT, enable_if_t<font color='#5555FF'>&lt;</font>is_std_char_type<font color='#5555FF'>&lt;</font>CharT<font color='#5555FF'>&gt;</font>::value<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>using</font> StringType <font color='#5555FF'>=</font> std::basic_string<font color='#5555FF'>&lt;</font>CharT<font color='#5555FF'>&gt;</font>;
    <font color='#0000FF'>using</font> StringCaster <font color='#5555FF'>=</font> make_caster<font color='#5555FF'>&lt;</font>StringType<font color='#5555FF'>&gt;</font>;
    StringCaster str_caster;
    <font color='#0000FF'><u>bool</u></font> none <font color='#5555FF'>=</font> <font color='#979000'>false</font>;
    CharT one_char <font color='#5555FF'>=</font> <font color='#979000'>0</font>;

<font color='#0000FF'>public</font>:
    <font color='#0000FF'><u>bool</u></font> <b><a name='load'></a>load</b><font face='Lucida Console'>(</font>handle src, <font color='#0000FF'><u>bool</u></font> convert<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>src<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
        <b>}</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>src.<font color='#BB00BB'>is_none</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
            <font color='#009900'>// Defer accepting None to other overloads (if we aren't in convert mode):
</font>            <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>convert<font face='Lucida Console'>)</font> <b>{</b>
                <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
            <b>}</b>
            none <font color='#5555FF'>=</font> <font color='#979000'>true</font>;
            <font color='#0000FF'>return</font> <font color='#979000'>true</font>;
        <b>}</b>
        <font color='#0000FF'>return</font> str_caster.<font color='#BB00BB'>load</font><font face='Lucida Console'>(</font>src, convert<font face='Lucida Console'>)</font>;
    <b>}</b>

    <font color='#0000FF'>static</font> handle <b><a name='cast'></a>cast</b><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> CharT <font color='#5555FF'>*</font>src, return_value_policy policy, handle parent<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>src <font color='#5555FF'>=</font><font color='#5555FF'>=</font> nullptr<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>return</font> pybind11::<font color='#BB00BB'>none</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>.<font color='#BB00BB'>release</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
        <b>}</b>
        <font color='#0000FF'>return</font> StringCaster::<font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font><font color='#BB00BB'>StringType</font><font face='Lucida Console'>(</font>src<font face='Lucida Console'>)</font>, policy, parent<font face='Lucida Console'>)</font>;
    <b>}</b>

    <font color='#0000FF'>static</font> handle <b><a name='cast'></a>cast</b><font face='Lucida Console'>(</font>CharT src, return_value_policy policy, handle parent<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>std::is_same<font color='#5555FF'>&lt;</font><font color='#0000FF'><u>char</u></font>, CharT<font color='#5555FF'>&gt;</font>::value<font face='Lucida Console'>)</font> <b>{</b>
            handle s <font color='#5555FF'>=</font> <font color='#BB00BB'>PyUnicode_DecodeLatin1</font><font face='Lucida Console'>(</font><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> <font color='#0000FF'><u>char</u></font> <font color='#5555FF'>*</font><font face='Lucida Console'>)</font> <font color='#5555FF'>&amp;</font>src, <font color='#979000'>1</font>, nullptr<font face='Lucida Console'>)</font>;
            <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>s<font face='Lucida Console'>)</font> <b>{</b>
                <font color='#0000FF'>throw</font> <font color='#BB00BB'>error_already_set</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
            <b>}</b>
            <font color='#0000FF'>return</font> s;
        <b>}</b>
        <font color='#0000FF'>return</font> StringCaster::<font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font><font color='#BB00BB'>StringType</font><font face='Lucida Console'>(</font><font color='#979000'>1</font>, src<font face='Lucida Console'>)</font>, policy, parent<font face='Lucida Console'>)</font>;
    <b>}</b>

    <font color='#0000FF'>explicit</font> <b><a name='operator'></a>operator</b> CharT <font color='#5555FF'>*</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>return</font> none ? nullptr : <font color='#0000FF'>const_cast</font><font color='#5555FF'>&lt;</font>CharT <font color='#5555FF'>*</font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font color='#0000FF'>static_cast</font><font color='#5555FF'>&lt;</font>StringType <font color='#5555FF'>&amp;</font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>str_caster<font face='Lucida Console'>)</font>.<font color='#BB00BB'>c_str</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
    <b>}</b>
    <font color='#0000FF'>explicit</font> <b><a name='operator'></a>operator</b> CharT <font color='#5555FF'>&amp;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>none<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>throw</font> <font color='#BB00BB'>value_error</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Cannot convert None to a character</font>"<font face='Lucida Console'>)</font>;
        <b>}</b>

        <font color='#0000FF'>auto</font> <font color='#5555FF'>&amp;</font>value <font color='#5555FF'>=</font> <font color='#0000FF'>static_cast</font><font color='#5555FF'>&lt;</font>StringType <font color='#5555FF'>&amp;</font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>str_caster<font face='Lucida Console'>)</font>;
        <font color='#0000FF'><u>size_t</u></font> str_len <font color='#5555FF'>=</font> value.<font color='#BB00BB'>size</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>str_len <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>0</font><font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>throw</font> <font color='#BB00BB'>value_error</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Cannot convert empty string to a character</font>"<font face='Lucida Console'>)</font>;
        <b>}</b>

        <font color='#009900'>// If we're in UTF-8 mode, we have two possible failures: one for a unicode character that
</font>        <font color='#009900'>// is too high, and one for multiple unicode characters (caught later), so we need to
</font>        <font color='#009900'>// figure out how long the first encoded character is in bytes to distinguish between these
</font>        <font color='#009900'>// two errors.  We also allow want to allow unicode characters U+0080 through U+00FF, as
</font>        <font color='#009900'>// those can fit into a single char value.
</font>        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>StringCaster::UTF_N <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>8</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> str_len <font color='#5555FF'>&gt;</font> <font color='#979000'>1</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> str_len <font color='#5555FF'>&lt;</font><font color='#5555FF'>=</font> <font color='#979000'>4</font><font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>auto</font> v0 <font color='#5555FF'>=</font> <font color='#0000FF'>static_cast</font><font color='#5555FF'>&lt;</font><font color='#0000FF'><u>unsigned</u></font> <font color='#0000FF'><u>char</u></font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>value[<font color='#979000'>0</font>]<font face='Lucida Console'>)</font>;
            <font color='#009900'>// low bits only: 0-127
</font>            <font color='#009900'>// 0b110xxxxx - start of 2-byte sequence
</font>            <font color='#009900'>// 0b1110xxxx - start of 3-byte sequence
</font>            <font color='#009900'>// 0b11110xxx - start of 4-byte sequence
</font>            <font color='#0000FF'><u>size_t</u></font> char0_bytes <font color='#5555FF'>=</font> <font face='Lucida Console'>(</font>v0 <font color='#5555FF'>&amp;</font> <font color='#979000'>0x80</font><font face='Lucida Console'>)</font> <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>0</font>      ? <font color='#979000'>1</font>
                                 : <font face='Lucida Console'>(</font>v0 <font color='#5555FF'>&amp;</font> <font color='#979000'>0xE0</font><font face='Lucida Console'>)</font> <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>0xC0</font> ? <font color='#979000'>2</font>
                                 : <font face='Lucida Console'>(</font>v0 <font color='#5555FF'>&amp;</font> <font color='#979000'>0xF0</font><font face='Lucida Console'>)</font> <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>0xE0</font> ? <font color='#979000'>3</font>
                                                       : <font color='#979000'>4</font>;

            <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>char0_bytes <font color='#5555FF'>=</font><font color='#5555FF'>=</font> str_len<font face='Lucida Console'>)</font> <b>{</b>
                <font color='#009900'>// If we have a 128-255 value, we can decode it into a single char:
</font>                <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>char0_bytes <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>2</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <font face='Lucida Console'>(</font>v0 <font color='#5555FF'>&amp;</font> <font color='#979000'>0xFC</font><font face='Lucida Console'>)</font> <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>0xC0</font><font face='Lucida Console'>)</font> <b>{</b> <font color='#009900'>// 0x110000xx 0x10xxxxxx
</font>                    one_char <font color='#5555FF'>=</font> <font color='#0000FF'>static_cast</font><font color='#5555FF'>&lt;</font>CharT<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>(</font><font face='Lucida Console'>(</font>v0 <font color='#5555FF'>&amp;</font> <font color='#979000'>3</font><font face='Lucida Console'>)</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&lt;</font> <font color='#979000'>6</font><font face='Lucida Console'>)</font>
                                                  <font color='#5555FF'>+</font> <font face='Lucida Console'>(</font><font color='#0000FF'>static_cast</font><font color='#5555FF'>&lt;</font><font color='#0000FF'><u>unsigned</u></font> <font color='#0000FF'><u>char</u></font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>value[<font color='#979000'>1</font>]<font face='Lucida Console'>)</font> <font color='#5555FF'>&amp;</font> <font color='#979000'>0x3F</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
                    <font color='#0000FF'>return</font> one_char;
                <b>}</b>
                <font color='#009900'>// Otherwise we have a single character, but it's &gt; U+00FF
</font>                <font color='#0000FF'>throw</font> <font color='#BB00BB'>value_error</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Character code point not in range(0x100)</font>"<font face='Lucida Console'>)</font>;
            <b>}</b>
        <b>}</b>

        <font color='#009900'>// UTF-16 is much easier: we can only have a surrogate pair for values above U+FFFF, thus a
</font>        <font color='#009900'>// surrogate pair with total length 2 instantly indicates a range error (but not a "your
</font>        <font color='#009900'>// string was too long" error).
</font>        <font color='#0000FF'>else</font> <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>StringCaster::UTF_N <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>16</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> str_len <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#979000'>2</font><font face='Lucida Console'>)</font> <b>{</b>
            one_char <font color='#5555FF'>=</font> <font color='#0000FF'>static_cast</font><font color='#5555FF'>&lt;</font>CharT<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>value[<font color='#979000'>0</font>]<font face='Lucida Console'>)</font>;
            <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>one_char <font color='#5555FF'>&gt;</font><font color='#5555FF'>=</font> <font color='#979000'>0xD800</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> one_char <font color='#5555FF'>&lt;</font> <font color='#979000'>0xE000</font><font face='Lucida Console'>)</font> <b>{</b>
                <font color='#0000FF'>throw</font> <font color='#BB00BB'>value_error</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Character code point not in range(0x10000)</font>"<font face='Lucida Console'>)</font>;
            <b>}</b>
        <b>}</b>

        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>str_len <font color='#5555FF'>!</font><font color='#5555FF'>=</font> <font color='#979000'>1</font><font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>throw</font> <font color='#BB00BB'>value_error</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Expected a character, but multi-character string found</font>"<font face='Lucida Console'>)</font>;
        <b>}</b>

        one_char <font color='#5555FF'>=</font> value[<font color='#979000'>0</font>];
        <font color='#0000FF'>return</font> one_char;
    <b>}</b>

    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <b><a name='const_name'></a>const_name</b><font face='Lucida Console'>(</font>PYBIND11_STRING_NAME<font face='Lucida Console'>)</font>;
    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> _T<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'>using</font> cast_op_type <font color='#5555FF'>=</font> pybind11::detail::cast_op_type<font color='#5555FF'>&lt;</font>_T<font color='#5555FF'>&gt;</font>;
<b>}</b>;

<font color='#009900'>// Base implementation for std::tuple and std::pair
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font>...<font color='#5555FF'>&gt;</font> <font color='#0000FF'>class</font> <b><a name='Tuple'></a>Tuple</b>, <font color='#0000FF'>typename</font>... Ts<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>class</font> <b><a name='tuple_caster'></a>tuple_caster</b> <b>{</b>
    <font color='#0000FF'>using</font> type <font color='#5555FF'>=</font> Tuple<font color='#5555FF'>&lt;</font>Ts...<font color='#5555FF'>&gt;</font>;
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> size <font color='#5555FF'>=</font> <font color='#0000FF'>sizeof</font>...<font face='Lucida Console'>(</font>Ts<font face='Lucida Console'>)</font>;
    <font color='#0000FF'>using</font> indices <font color='#5555FF'>=</font> make_index_sequence<font color='#5555FF'>&lt;</font>size<font color='#5555FF'>&gt;</font>;

<font color='#0000FF'>public</font>:
    <font color='#0000FF'><u>bool</u></font> <b><a name='load'></a>load</b><font face='Lucida Console'>(</font>handle src, <font color='#0000FF'><u>bool</u></font> convert<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>isinstance<font color='#5555FF'>&lt;</font>sequence<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>src<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
        <b>}</b>
        <font color='#0000FF'>const</font> <font color='#0000FF'>auto</font> seq <font color='#5555FF'>=</font> reinterpret_borrow<font color='#5555FF'>&lt;</font>sequence<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>src<font face='Lucida Console'>)</font>;
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>seq.<font color='#BB00BB'>size</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>!</font><font color='#5555FF'>=</font> size<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
        <b>}</b>
        <font color='#0000FF'>return</font> <font color='#BB00BB'>load_impl</font><font face='Lucida Console'>(</font>seq, convert, indices<b>{</b><b>}</b><font face='Lucida Console'>)</font>;
    <b>}</b>

    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'>static</font> handle <b><a name='cast'></a>cast</b><font face='Lucida Console'>(</font>T <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>src, return_value_policy policy, handle parent<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>return</font> <font color='#BB00BB'>cast_impl</font><font face='Lucida Console'>(</font>std::forward<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>src<font face='Lucida Console'>)</font>, policy, parent, indices<b>{</b><b>}</b><font face='Lucida Console'>)</font>;
    <b>}</b>

    <font color='#009900'>// copied from the PYBIND11_TYPE_CASTER macro
</font>    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'>static</font> handle <b><a name='cast'></a>cast</b><font face='Lucida Console'>(</font>T <font color='#5555FF'>*</font>src, return_value_policy policy, handle parent<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>src<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>return</font> <font color='#BB00BB'>none</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>.<font color='#BB00BB'>release</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
        <b>}</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>policy <font color='#5555FF'>=</font><font color='#5555FF'>=</font> return_value_policy::take_ownership<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>auto</font> h <font color='#5555FF'>=</font> <font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font>std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font><font color='#5555FF'>*</font>src<font face='Lucida Console'>)</font>, policy, parent<font face='Lucida Console'>)</font>;
            <font color='#0000FF'>delete</font> src;
            <font color='#0000FF'>return</font> h;
        <b>}</b>
        <font color='#0000FF'>return</font> <font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font><font color='#5555FF'>*</font>src, policy, parent<font face='Lucida Console'>)</font>;
    <b>}</b>

    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <b><a name='const_name'></a>const_name</b><font face='Lucida Console'>(</font>"<font color='#CC0000'>tuple[</font>"<font face='Lucida Console'>)</font>
                                 <font color='#5555FF'>+</font> ::pybind11::detail::<b><a name='concat'></a>concat</b><font face='Lucida Console'>(</font>make_caster<font color='#5555FF'>&lt;</font>Ts<font color='#5555FF'>&gt;</font>::name...<font face='Lucida Console'>)</font>
                                 <font color='#5555FF'>+</font> <b><a name='const_name'></a>const_name</b><font face='Lucida Console'>(</font>"<font color='#CC0000'>]</font>"<font face='Lucida Console'>)</font>;

    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'>using</font> cast_op_type <font color='#5555FF'>=</font> type;

    <font color='#0000FF'>explicit</font> <b><a name='operator'></a>operator</b> <b><a name='type'></a>type</b><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>&amp;</font> <b>{</b> <font color='#0000FF'>return</font> <font color='#BB00BB'>implicit_cast</font><font face='Lucida Console'>(</font>indices<b>{</b><b>}</b><font face='Lucida Console'>)</font>; <b>}</b>
    <font color='#0000FF'>explicit</font> <b><a name='operator'></a>operator</b> <b><a name='type'></a>type</b><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <b>{</b> <font color='#0000FF'>return</font> std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font><font color='#5555FF'>*</font><font color='#0000FF'>this</font><font face='Lucida Console'>)</font>.<font color='#BB00BB'>implicit_cast</font><font face='Lucida Console'>(</font>indices<b>{</b><b>}</b><font face='Lucida Console'>)</font>; <b>}</b>

<font color='#0000FF'>protected</font>:
    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'><u>size_t</u></font>... Is<font color='#5555FF'>&gt;</font>
    type <b><a name='implicit_cast'></a>implicit_cast</b><font face='Lucida Console'>(</font>index_sequence<font color='#5555FF'>&lt;</font>Is...<font color='#5555FF'>&gt;</font><font face='Lucida Console'>)</font> <font color='#5555FF'>&amp;</font> <b>{</b>
        <font color='#0000FF'>return</font> <font color='#BB00BB'>type</font><font face='Lucida Console'>(</font>cast_op<font color='#5555FF'>&lt;</font>Ts<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>std::get<font color='#5555FF'>&lt;</font>Is<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>subcasters<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>...<font face='Lucida Console'>)</font>;
    <b>}</b>
    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'><u>size_t</u></font>... Is<font color='#5555FF'>&gt;</font>
    type <b><a name='implicit_cast'></a>implicit_cast</b><font face='Lucida Console'>(</font>index_sequence<font color='#5555FF'>&lt;</font>Is...<font color='#5555FF'>&gt;</font><font face='Lucida Console'>)</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <b>{</b>
        <font color='#0000FF'>return</font> <font color='#BB00BB'>type</font><font face='Lucida Console'>(</font>cast_op<font color='#5555FF'>&lt;</font>Ts<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font>std::get<font color='#5555FF'>&lt;</font>Is<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>subcasters<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>...<font face='Lucida Console'>)</font>;
    <b>}</b>

    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'><u>bool</u></font> <b><a name='load_impl'></a>load_impl</b><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> sequence <font color='#5555FF'>&amp;</font>, <font color='#0000FF'><u>bool</u></font>, index_sequence<font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>)</font> <b>{</b> <font color='#0000FF'>return</font> <font color='#979000'>true</font>; <b>}</b>

    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'><u>size_t</u></font>... Is<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'><u>bool</u></font> <b><a name='load_impl'></a>load_impl</b><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> sequence <font color='#5555FF'>&amp;</font>seq, <font color='#0000FF'><u>bool</u></font> convert, index_sequence<font color='#5555FF'>&lt;</font>Is...<font color='#5555FF'>&gt;</font><font face='Lucida Console'>)</font> <b>{</b>
<font color='#0000FF'>#ifdef</font> __cpp_fold_expressions
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font face='Lucida Console'>(</font>... <font color='#5555FF'>|</font><font color='#5555FF'>|</font> <font color='#5555FF'>!</font>std::get<font color='#5555FF'>&lt;</font>Is<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>subcasters<font face='Lucida Console'>)</font>.<font color='#BB00BB'>load</font><font face='Lucida Console'>(</font>seq[Is], convert<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
        <b>}</b>
<font color='#0000FF'>#else</font>
        <font color='#0000FF'>for</font> <font face='Lucida Console'>(</font><font color='#0000FF'><u>bool</u></font> r : <b>{</b>std::get<font color='#5555FF'>&lt;</font>Is<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>subcasters<font face='Lucida Console'>)</font>.<font color='#BB00BB'>load</font><font face='Lucida Console'>(</font>seq[Is], convert<font face='Lucida Console'>)</font>...<b>}</b><font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>r<font face='Lucida Console'>)</font> <b>{</b>
                <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
            <b>}</b>
        <b>}</b>
<font color='#0000FF'>#endif</font>
        <font color='#0000FF'>return</font> <font color='#979000'>true</font>;
    <b>}</b>

    <font color='#009900'>/* Implementation: Convert a C++ tuple into a Python tuple */</font>
    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T, <font color='#0000FF'><u>size_t</u></font>... Is<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'>static</font> handle
    <b><a name='cast_impl'></a>cast_impl</b><font face='Lucida Console'>(</font>T <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>src, return_value_policy policy, handle parent, index_sequence<font color='#5555FF'>&lt;</font>Is...<font color='#5555FF'>&gt;</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#BB00BB'>PYBIND11_WORKAROUND_INCORRECT_MSVC_C4100</font><font face='Lucida Console'>(</font>src, policy, parent<font face='Lucida Console'>)</font>;
        <font color='#BB00BB'>PYBIND11_WORKAROUND_INCORRECT_GCC_UNUSED_BUT_SET_PARAMETER</font><font face='Lucida Console'>(</font>policy, parent<font face='Lucida Console'>)</font>;
        std::array<font color='#5555FF'>&lt;</font>object, size<font color='#5555FF'>&gt;</font> entries<b>{</b><b>{</b>reinterpret_steal<font color='#5555FF'>&lt;</font>object<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>
            make_caster<font color='#5555FF'>&lt;</font>Ts<font color='#5555FF'>&gt;</font>::<font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font>std::get<font color='#5555FF'>&lt;</font>Is<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>std::forward<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>src<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>, policy, parent<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>...<b>}</b><b>}</b>;
        <font color='#0000FF'>for</font> <font face='Lucida Console'>(</font><font color='#0000FF'>const</font> <font color='#0000FF'>auto</font> <font color='#5555FF'>&amp;</font>entry : entries<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>entry<font face='Lucida Console'>)</font> <b>{</b>
                <font color='#0000FF'>return</font> <font color='#BB00BB'>handle</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
            <b>}</b>
        <b>}</b>
        tuple <font color='#BB00BB'>result</font><font face='Lucida Console'>(</font>size<font face='Lucida Console'>)</font>;
        <font color='#0000FF'><u>int</u></font> counter <font color='#5555FF'>=</font> <font color='#979000'>0</font>;
        <font color='#0000FF'>for</font> <font face='Lucida Console'>(</font><font color='#0000FF'>auto</font> <font color='#5555FF'>&amp;</font>entry : entries<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#BB00BB'>PyTuple_SET_ITEM</font><font face='Lucida Console'>(</font>result.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>, counter<font color='#5555FF'>+</font><font color='#5555FF'>+</font>, entry.<font color='#BB00BB'>release</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
        <b>}</b>
        <font color='#0000FF'>return</font> result.<font color='#BB00BB'>release</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
    <b>}</b>

    Tuple<font color='#5555FF'>&lt;</font>make_caster<font color='#5555FF'>&lt;</font>Ts<font color='#5555FF'>&gt;</font>...<font color='#5555FF'>&gt;</font> subcasters;
<b>}</b>;

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T1, <font color='#0000FF'>typename</font> T2<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>class</font> <b><a name='type_caster'></a>type_caster</b><font color='#5555FF'>&lt;</font>std::pair<font color='#5555FF'>&lt;</font>T1, T2<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font> : <font color='#0000FF'>public</font> tuple_caster<font color='#5555FF'>&lt;</font>std::pair, T1, T2<font color='#5555FF'>&gt;</font> <b>{</b><b>}</b>;

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font>... Ts<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>class</font> <b><a name='type_caster'></a>type_caster</b><font color='#5555FF'>&lt;</font>std::tuple<font color='#5555FF'>&lt;</font>Ts...<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font> : <font color='#0000FF'>public</font> tuple_caster<font color='#5555FF'>&lt;</font>std::tuple, Ts...<font color='#5555FF'>&gt;</font> <b>{</b><b>}</b>;

<font color='#009900'>/// Helper class which abstracts away certain actions. Users can provide specializations for
</font><font color='#009900'>/// custom holders, but it's only necessary if the type has a non-standard interface.
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='holder_helper'></a>holder_helper</b> <b>{</b>
    <font color='#0000FF'>static</font> <font color='#0000FF'>auto</font> <b><a name='get'></a>get</b><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> T <font color='#5555FF'>&amp;</font>p<font face='Lucida Console'>)</font> <font color='#5555FF'>-</font><font color='#5555FF'>&gt;</font> <b><a name='decltype'></a>decltype</b><font face='Lucida Console'>(</font>p.<font color='#BB00BB'>get</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b> <font color='#0000FF'>return</font> p.<font color='#BB00BB'>get</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>; <b>}</b>
<b>}</b>;

<font color='#009900'>/// Type caster for holder types like std::shared_ptr, etc.
</font><font color='#009900'>/// The SFINAE hook is provided to help work around the current lack of support
</font><font color='#009900'>/// for smart-pointer interoperability. Please consider it an implementation
</font><font color='#009900'>/// detail that may change in the future, as formal support for smart-pointer
</font><font color='#009900'>/// interoperability is added into pybind11.
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> type, <font color='#0000FF'>typename</font> holder_type, <font color='#0000FF'>typename</font> SFINAE <font color='#5555FF'>=</font> <font color='#0000FF'><u>void</u></font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='copyable_holder_caster'></a>copyable_holder_caster</b> : <font color='#0000FF'>public</font> type_caster_base<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font> <b>{</b>
<font color='#0000FF'>public</font>:
    <font color='#0000FF'>using</font> base <font color='#5555FF'>=</font> type_caster_base<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font>;
    <b><a name='static_assert'></a>static_assert</b><font face='Lucida Console'>(</font>std::is_base_of<font color='#5555FF'>&lt;</font>base, type_caster<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>::value,
                  "<font color='#CC0000'>Holder classes are only supported for custom types</font>"<font face='Lucida Console'>)</font>;
    <font color='#0000FF'>using</font> base::base;
    <font color='#0000FF'>using</font> base::cast;
    <font color='#0000FF'>using</font> base::typeinfo;
    <font color='#0000FF'>using</font> base::value;

    <font color='#0000FF'><u>bool</u></font> <b><a name='load'></a>load</b><font face='Lucida Console'>(</font>handle src, <font color='#0000FF'><u>bool</u></font> convert<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>return</font> base::<font color='#0000FF'>template</font> load_impl<font color='#5555FF'>&lt;</font>copyable_holder_caster<font color='#5555FF'>&lt;</font>type, holder_type<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>src, convert<font face='Lucida Console'>)</font>;
    <b>}</b>

    <font color='#0000FF'>explicit</font> <b><a name='operator'></a>operator</b> type <font color='#5555FF'>*</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <b>{</b> <font color='#0000FF'>return</font> <font color='#0000FF'>this</font><font color='#5555FF'>-</font><font color='#5555FF'>&gt;</font>value; <b>}</b>
    <font color='#009900'>// static_cast works around compiler error with MSVC 17 and CUDA 10.2
</font>    <font color='#009900'>// see issue #2180
</font>    <font color='#0000FF'>explicit</font> <b><a name='operator'></a>operator</b> type <font color='#5555FF'>&amp;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <b>{</b> <font color='#0000FF'>return</font> <font color='#5555FF'>*</font><font face='Lucida Console'>(</font><font color='#0000FF'>static_cast</font><font color='#5555FF'>&lt;</font>type <font color='#5555FF'>*</font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font color='#0000FF'>this</font><font color='#5555FF'>-</font><font color='#5555FF'>&gt;</font>value<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>; <b>}</b>
    <font color='#0000FF'>explicit</font> <b><a name='operator'></a>operator</b> holder_type <font color='#5555FF'>*</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <b>{</b> <font color='#0000FF'>return</font> std::<font color='#BB00BB'>addressof</font><font face='Lucida Console'>(</font>holder<font face='Lucida Console'>)</font>; <b>}</b>
    <font color='#0000FF'>explicit</font> <b><a name='operator'></a>operator</b> holder_type <font color='#5555FF'>&amp;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <b>{</b> <font color='#0000FF'>return</font> holder; <b>}</b>

    <font color='#0000FF'>static</font> handle <b><a name='cast'></a>cast</b><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> holder_type <font color='#5555FF'>&amp;</font>src, return_value_policy, handle<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>const</font> <font color='#0000FF'>auto</font> <font color='#5555FF'>*</font>ptr <font color='#5555FF'>=</font> holder_helper<font color='#5555FF'>&lt;</font>holder_type<font color='#5555FF'>&gt;</font>::<font color='#BB00BB'>get</font><font face='Lucida Console'>(</font>src<font face='Lucida Console'>)</font>;
        <font color='#0000FF'>return</font> type_caster_base<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font>::<font color='#BB00BB'>cast_holder</font><font face='Lucida Console'>(</font>ptr, <font color='#5555FF'>&amp;</font>src<font face='Lucida Console'>)</font>;
    <b>}</b>

<font color='#0000FF'>protected</font>:
    <font color='#0000FF'>friend</font> <font color='#0000FF'>class</font> <b><a name='type_caster_generic'></a>type_caster_generic</b>;
    <font color='#0000FF'><u>void</u></font> <b><a name='check_holder_compat'></a>check_holder_compat</b><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>typeinfo<font color='#5555FF'>-</font><font color='#5555FF'>&gt;</font>default_holder<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>throw</font> <font color='#BB00BB'>cast_error</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Unable to load a custom holder type from a default-holder instance</font>"<font face='Lucida Console'>)</font>;
        <b>}</b>
    <b>}</b>

    <font color='#0000FF'><u>bool</u></font> <b><a name='load_value'></a>load_value</b><font face='Lucida Console'>(</font>value_and_holder <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>v_h<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>v_h.<font color='#BB00BB'>holder_constructed</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
            value <font color='#5555FF'>=</font> v_h.<font color='#BB00BB'>value_ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
            holder <font color='#5555FF'>=</font> v_h.<font color='#0000FF'>template</font> holder<font color='#5555FF'>&lt;</font>holder_type<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
            <font color='#0000FF'>return</font> <font color='#979000'>true</font>;
        <b>}</b>
        <font color='#0000FF'>throw</font> <font color='#BB00BB'>cast_error</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Unable to cast from non-held to held instance (T&amp; to Holder&lt;T&gt;) </font>"
<font color='#0000FF'>#if</font> <font color='#5555FF'>!</font>defined<font face='Lucida Console'>(</font>PYBIND11_DETAILED_ERROR_MESSAGES<font face='Lucida Console'>)</font>
                         "<font color='#CC0000'>(#define PYBIND11_DETAILED_ERROR_MESSAGES or compile in debug mode for </font>"
                         "<font color='#CC0000'>type information)</font>"<font face='Lucida Console'>)</font>;
<font color='#0000FF'>#else</font>
                         "<font color='#CC0000'>of type '</font>"
                         <font color='#5555FF'>+</font> type_id<font color='#5555FF'>&lt;</font>holder_type<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>+</font> "<font color='#CC0000'>''</font>"<font face='Lucida Console'>)</font>;
<font color='#0000FF'>#endif</font>
    <b>}</b>

    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T <font color='#5555FF'>=</font> holder_type,
              detail::enable_if_t<font color='#5555FF'>&lt;</font><font color='#5555FF'>!</font>std::is_constructible<font color='#5555FF'>&lt;</font>T, <font color='#0000FF'>const</font> T <font color='#5555FF'>&amp;</font>, type <font color='#5555FF'>*</font><font color='#5555FF'>&gt;</font>::value, <font color='#0000FF'><u>int</u></font><font color='#5555FF'>&gt;</font> <font color='#5555FF'>=</font> <font color='#979000'>0</font><font color='#5555FF'>&gt;</font>
    <font color='#0000FF'><u>bool</u></font> <font color='#BB00BB'>try_implicit_casts</font><font face='Lucida Console'>(</font>handle, <font color='#0000FF'><u>bool</u></font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
    <b>}</b>

    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T <font color='#5555FF'>=</font> holder_type,
              detail::enable_if_t<font color='#5555FF'>&lt;</font>std::is_constructible<font color='#5555FF'>&lt;</font>T, <font color='#0000FF'>const</font> T <font color='#5555FF'>&amp;</font>, type <font color='#5555FF'>*</font><font color='#5555FF'>&gt;</font>::value, <font color='#0000FF'><u>int</u></font><font color='#5555FF'>&gt;</font> <font color='#5555FF'>=</font> <font color='#979000'>0</font><font color='#5555FF'>&gt;</font>
    <font color='#0000FF'><u>bool</u></font> <font color='#BB00BB'>try_implicit_casts</font><font face='Lucida Console'>(</font>handle src, <font color='#0000FF'><u>bool</u></font> convert<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>for</font> <font face='Lucida Console'>(</font><font color='#0000FF'>auto</font> <font color='#5555FF'>&amp;</font>cast : typeinfo<font color='#5555FF'>-</font><font color='#5555FF'>&gt;</font>implicit_casts<font face='Lucida Console'>)</font> <b>{</b>
            copyable_holder_caster <font color='#BB00BB'>sub_caster</font><font face='Lucida Console'>(</font><font color='#5555FF'>*</font>cast.first<font face='Lucida Console'>)</font>;
            <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>sub_caster.<font color='#BB00BB'>load</font><font face='Lucida Console'>(</font>src, convert<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
                value <font color='#5555FF'>=</font> cast.<font color='#BB00BB'>second</font><font face='Lucida Console'>(</font>sub_caster.value<font face='Lucida Console'>)</font>;
                holder <font color='#5555FF'>=</font> <font color='#BB00BB'>holder_type</font><font face='Lucida Console'>(</font>sub_caster.holder, <font face='Lucida Console'>(</font>type <font color='#5555FF'>*</font><font face='Lucida Console'>)</font> value<font face='Lucida Console'>)</font>;
                <font color='#0000FF'>return</font> <font color='#979000'>true</font>;
            <b>}</b>
        <b>}</b>
        <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
    <b>}</b>

    <font color='#0000FF'>static</font> <font color='#0000FF'><u>bool</u></font> <font color='#BB00BB'>try_direct_conversions</font><font face='Lucida Console'>(</font>handle<font face='Lucida Console'>)</font> <b>{</b> <font color='#0000FF'>return</font> <font color='#979000'>false</font>; <b>}</b>

    holder_type holder;
<b>}</b>;

<font color='#009900'>/// Specialize for the common std::shared_ptr, so users don't need to
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>class</font> <b><a name='type_caster'></a>type_caster</b><font color='#5555FF'>&lt;</font>std::shared_ptr<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font> : <font color='#0000FF'>public</font> copyable_holder_caster<font color='#5555FF'>&lt;</font>T, std::shared_ptr<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font> <b>{</b><b>}</b>;

<font color='#009900'>/// Type caster for holder types like std::unique_ptr.
</font><font color='#009900'>/// Please consider the SFINAE hook an implementation detail, as explained
</font><font color='#009900'>/// in the comment for the copyable_holder_caster.
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> type, <font color='#0000FF'>typename</font> holder_type, <font color='#0000FF'>typename</font> SFINAE <font color='#5555FF'>=</font> <font color='#0000FF'><u>void</u></font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='move_only_holder_caster'></a>move_only_holder_caster</b> <b>{</b>
    <font color='#BB00BB'>static_assert</font><font face='Lucida Console'>(</font>std::is_base_of<font color='#5555FF'>&lt;</font>type_caster_base<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font>, type_caster<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>::value,
                  "<font color='#CC0000'>Holder classes are only supported for custom types</font>"<font face='Lucida Console'>)</font>;

    <font color='#0000FF'>static</font> handle <font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font>holder_type <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>src, return_value_policy, handle<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>auto</font> <font color='#5555FF'>*</font>ptr <font color='#5555FF'>=</font> holder_helper<font color='#5555FF'>&lt;</font>holder_type<font color='#5555FF'>&gt;</font>::<font color='#BB00BB'>get</font><font face='Lucida Console'>(</font>src<font face='Lucida Console'>)</font>;
        <font color='#0000FF'>return</font> type_caster_base<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font>::<font color='#BB00BB'>cast_holder</font><font face='Lucida Console'>(</font>ptr, std::<font color='#BB00BB'>addressof</font><font face='Lucida Console'>(</font>src<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
    <b>}</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> type_caster_base<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font>::name;
<b>}</b>;

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> type, <font color='#0000FF'>typename</font> deleter<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>class</font> <b><a name='type_caster'></a>type_caster</b><font color='#5555FF'>&lt;</font>std::unique_ptr<font color='#5555FF'>&lt;</font>type, deleter<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>
    : <font color='#0000FF'>public</font> move_only_holder_caster<font color='#5555FF'>&lt;</font>type, std::unique_ptr<font color='#5555FF'>&lt;</font>type, deleter<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font> <b>{</b><b>}</b>;

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> type, <font color='#0000FF'>typename</font> holder_type<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>using</font> type_caster_holder <font color='#5555FF'>=</font> conditional_t<font color='#5555FF'>&lt;</font>is_copy_constructible<font color='#5555FF'>&lt;</font>holder_type<font color='#5555FF'>&gt;</font>::value,
                                         copyable_holder_caster<font color='#5555FF'>&lt;</font>type, holder_type<font color='#5555FF'>&gt;</font>,
                                         move_only_holder_caster<font color='#5555FF'>&lt;</font>type, holder_type<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>;

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T, <font color='#0000FF'><u>bool</u></font> Value <font color='#5555FF'>=</font> <font color='#979000'>false</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='always_construct_holder'></a>always_construct_holder</b> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'><u>bool</u></font> value <font color='#5555FF'>=</font> Value;
<b>}</b>;

<font color='#009900'>/// Create a specialization for custom holder types (silently ignores std::shared_ptr)
</font><font color='#0000FF'>#define</font> PYBIND11_DECLARE_HOLDER_TYPE<font face='Lucida Console'>(</font>type, holder_type, ...<font face='Lucida Console'>)</font>                                      \
    <font color='#BB00BB'>PYBIND11_NAMESPACE_BEGIN</font><font face='Lucida Console'>(</font>PYBIND11_NAMESPACE<font face='Lucida Console'>)</font>                                                  \
    <font color='#0000FF'>namespace</font> detail <b>{</b>                                                                            \
    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> type<font color='#5555FF'>&gt;</font>                                                                      \
    <font color='#0000FF'>struct</font> <b><a name='always_construct_holder'></a>always_construct_holder</b><font color='#5555FF'>&lt;</font>holder_type<font color='#5555FF'>&gt;</font> : always_construct_holder<font color='#5555FF'>&lt;</font><font color='#0000FF'><u>void</u></font>, ##__VA_ARGS__<font color='#5555FF'>&gt;</font> <b>{</b>  \
    <b>}</b>;                                                                                            \
    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> type<font color='#5555FF'>&gt;</font>                                                                      \
    <font color='#0000FF'>class</font> <b><a name='type_caster'></a>type_caster</b><font color='#5555FF'>&lt;</font>holder_type, enable_if_t<font color='#5555FF'>&lt;</font><font color='#5555FF'>!</font>is_shared_ptr<font color='#5555FF'>&lt;</font>holder_type<font color='#5555FF'>&gt;</font>::value<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>               \
        : <font color='#0000FF'>public</font> type_caster_holder<font color='#5555FF'>&lt;</font>type, holder_type<font color='#5555FF'>&gt;</font> <b>{</b><b>}</b>;                                        \
    <b>}</b>                                                                                             \
    <font color='#BB00BB'>PYBIND11_NAMESPACE_END</font><font face='Lucida Console'>(</font>PYBIND11_NAMESPACE<font face='Lucida Console'>)</font>

<font color='#009900'>// PYBIND11_DECLARE_HOLDER_TYPE holder types:
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> base, <font color='#0000FF'>typename</font> holder<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='is_holder_type'></a>is_holder_type</b>
    : std::is_base_of<font color='#5555FF'>&lt;</font>detail::type_caster_holder<font color='#5555FF'>&lt;</font>base, holder<font color='#5555FF'>&gt;</font>, detail::type_caster<font color='#5555FF'>&lt;</font>holder<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font> <b>{</b><b>}</b>;
<font color='#009900'>// Specialization for always-supported unique_ptr holders:
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> base, <font color='#0000FF'>typename</font> deleter<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='is_holder_type'></a>is_holder_type</b><font color='#5555FF'>&lt;</font>base, std::unique_ptr<font color='#5555FF'>&lt;</font>base, deleter<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font> : std::true_type <b>{</b><b>}</b>;

<font color='#0000FF'>#ifdef</font> PYBIND11_DISABLE_HANDLE_TYPE_NAME_DEFAULT_IMPLEMENTATION <font color='#009900'>// See PR #4888
</font>
<font color='#009900'>// This leads to compilation errors if a specialization is missing.
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b>;

<font color='#0000FF'>#else</font>

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> const_name<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
<b>}</b>;

<font color='#0000FF'>#endif</font>

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>object<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>object</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>list<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>list</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>dict<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>dict</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>anyset<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Union[set, frozenset]</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>set<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>set</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>frozenset<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>frozenset</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>str<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>str</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>tuple<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>tuple</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>bool_<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>bool</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>bytes<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>PYBIND11_BYTES_NAME<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>buffer<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Buffer</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>int_<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>int</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>iterable<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Iterable</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>iterator<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Iterator</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>float_<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>float</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>function<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Callable</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>handle<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> handle_type_name<font color='#5555FF'>&lt;</font>object<font color='#5555FF'>&gt;</font>::name;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>none<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>None</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>sequence<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Sequence</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>bytearray<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>bytearray</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>memoryview<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>memoryview</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>slice<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>slice</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>type</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>capsule<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>capsule</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>ellipsis<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>ellipsis</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>weakref<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>weakref</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>args<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>*args</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>kwargs<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> <font color='#BB00BB'>const_name</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>**kwargs</font>"<font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>obj_attr_accessor<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> const_name<font color='#5555FF'>&lt;</font>obj_attr_accessor<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>str_attr_accessor<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> const_name<font color='#5555FF'>&lt;</font>str_attr_accessor<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>item_accessor<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> const_name<font color='#5555FF'>&lt;</font>item_accessor<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>sequence_accessor<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> const_name<font color='#5555FF'>&lt;</font>sequence_accessor<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>list_accessor<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> const_name<font color='#5555FF'>&lt;</font>list_accessor<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
<b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='handle_type_name'></a>handle_type_name</b><font color='#5555FF'>&lt;</font>tuple_accessor<font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> name <font color='#5555FF'>=</font> const_name<font color='#5555FF'>&lt;</font>tuple_accessor<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
<b>}</b>;

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> type<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='pyobject_caster'></a>pyobject_caster</b> <b>{</b>
    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T <font color='#5555FF'>=</font> type, enable_if_t<font color='#5555FF'>&lt;</font>std::is_same<font color='#5555FF'>&lt;</font>T, handle<font color='#5555FF'>&gt;</font>::value, <font color='#0000FF'><u>int</u></font><font color='#5555FF'>&gt;</font> <font color='#5555FF'>=</font> <font color='#979000'>0</font><font color='#5555FF'>&gt;</font>
    <font color='#BB00BB'>pyobject_caster</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> : value<font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <b>{</b><b>}</b>

    <font color='#009900'>// `type` may not be default constructible (e.g. frozenset, anyset).  Initializing `value`
</font>    <font color='#009900'>// to a nil handle is safe since it will only be accessed if `load` succeeds.
</font>    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T <font color='#5555FF'>=</font> type, enable_if_t<font color='#5555FF'>&lt;</font>std::is_base_of<font color='#5555FF'>&lt;</font>object, T<font color='#5555FF'>&gt;</font>::value, <font color='#0000FF'><u>int</u></font><font color='#5555FF'>&gt;</font> <font color='#5555FF'>=</font> <font color='#979000'>0</font><font color='#5555FF'>&gt;</font>
    <font color='#BB00BB'>pyobject_caster</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> : value<font face='Lucida Console'>(</font>reinterpret_steal<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>handle<font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b><b>}</b>

    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T <font color='#5555FF'>=</font> type, enable_if_t<font color='#5555FF'>&lt;</font>std::is_same<font color='#5555FF'>&lt;</font>T, handle<font color='#5555FF'>&gt;</font>::value, <font color='#0000FF'><u>int</u></font><font color='#5555FF'>&gt;</font> <font color='#5555FF'>=</font> <font color='#979000'>0</font><font color='#5555FF'>&gt;</font>
    <font color='#0000FF'><u>bool</u></font> <font color='#BB00BB'>load</font><font face='Lucida Console'>(</font>handle src, <font color='#0000FF'><u>bool</u></font> <font color='#009900'>/* convert */</font><font face='Lucida Console'>)</font> <b>{</b>
        value <font color='#5555FF'>=</font> src;
        <font color='#0000FF'>return</font> <font color='#0000FF'>static_cast</font><font color='#5555FF'>&lt;</font><font color='#0000FF'><u>bool</u></font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>value<font face='Lucida Console'>)</font>;
    <b>}</b>

    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T <font color='#5555FF'>=</font> type, enable_if_t<font color='#5555FF'>&lt;</font>std::is_base_of<font color='#5555FF'>&lt;</font>object, T<font color='#5555FF'>&gt;</font>::value, <font color='#0000FF'><u>int</u></font><font color='#5555FF'>&gt;</font> <font color='#5555FF'>=</font> <font color='#979000'>0</font><font color='#5555FF'>&gt;</font>
    <font color='#0000FF'><u>bool</u></font> <font color='#BB00BB'>load</font><font face='Lucida Console'>(</font>handle src, <font color='#0000FF'><u>bool</u></font> <font color='#009900'>/* convert */</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>isinstance<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>src<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
        <b>}</b>
        value <font color='#5555FF'>=</font> reinterpret_borrow<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>src<font face='Lucida Console'>)</font>;
        <font color='#0000FF'>return</font> <font color='#979000'>true</font>;
    <b>}</b>

    <font color='#0000FF'>static</font> handle <font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> handle <font color='#5555FF'>&amp;</font>src, return_value_policy <font color='#009900'>/* policy */</font>, handle <font color='#009900'>/* parent */</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>return</font> src.<font color='#BB00BB'>inc_ref</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
    <b>}</b>
    <font color='#BB00BB'>PYBIND11_TYPE_CASTER</font><font face='Lucida Console'>(</font>type, handle_type_name<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font>::name<font face='Lucida Console'>)</font>;
<b>}</b>;

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>class</font> <b><a name='type_caster'></a>type_caster</b><font color='#5555FF'>&lt;</font>T, enable_if_t<font color='#5555FF'>&lt;</font>is_pyobject<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font> : <font color='#0000FF'>public</font> pyobject_caster<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font> <b>{</b><b>}</b>;

<font color='#009900'>// Our conditions for enabling moving are quite restrictive:
</font><font color='#009900'>// At compile time:
</font><font color='#009900'>// - T needs to be a non-const, non-pointer, non-reference type
</font><font color='#009900'>// - type_caster&lt;T&gt;::operator T&amp;() must exist
</font><font color='#009900'>// - the type must be move constructible (obviously)
</font><font color='#009900'>// At run-time:
</font><font color='#009900'>// - if the type is non-copy-constructible, the object must be the sole owner of the type (i.e. it
</font><font color='#009900'>//   must have ref_count() == 1)h
</font><font color='#009900'>// If any of the above are not satisfied, we fall back to copying.
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>using</font> move_is_plain_type
    <font color='#5555FF'>=</font> satisfies_none_of<font color='#5555FF'>&lt;</font>T, std::is_void, std::is_pointer, std::is_reference, std::is_const<font color='#5555FF'>&gt;</font>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T, <font color='#0000FF'>typename</font> SFINAE <font color='#5555FF'>=</font> <font color='#0000FF'><u>void</u></font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='move_always'></a>move_always</b> : std::false_type <b>{</b><b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='move_always'></a>move_always</b><font color='#5555FF'>&lt;</font>
    T,
    enable_if_t<font color='#5555FF'>&lt;</font>
        all_of<font color='#5555FF'>&lt;</font>move_is_plain_type<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>,
               negation<font color='#5555FF'>&lt;</font>is_copy_constructible<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>,
               is_move_constructible<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>,
               std::is_same<font color='#5555FF'>&lt;</font><font color='#BB00BB'>decltype</font><font face='Lucida Console'>(</font>std::declval<font color='#5555FF'>&lt;</font>make_caster<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>.<b><a name='operator'></a>operator</b> T <font color='#5555FF'>&amp;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>, T <font color='#5555FF'>&amp;</font><font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>::value<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>
    : std::true_type <b>{</b><b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T, <font color='#0000FF'>typename</font> SFINAE <font color='#5555FF'>=</font> <font color='#0000FF'><u>void</u></font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='move_if_unreferenced'></a>move_if_unreferenced</b> : std::false_type <b>{</b><b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='move_if_unreferenced'></a>move_if_unreferenced</b><font color='#5555FF'>&lt;</font>
    T,
    enable_if_t<font color='#5555FF'>&lt;</font>
        all_of<font color='#5555FF'>&lt;</font>move_is_plain_type<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>,
               negation<font color='#5555FF'>&lt;</font>move_always<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>,
               is_move_constructible<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>,
               std::is_same<font color='#5555FF'>&lt;</font><font color='#BB00BB'>decltype</font><font face='Lucida Console'>(</font>std::declval<font color='#5555FF'>&lt;</font>make_caster<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>.<b><a name='operator'></a>operator</b> T <font color='#5555FF'>&amp;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>, T <font color='#5555FF'>&amp;</font><font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>::value<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>
    : std::true_type <b>{</b><b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>using</font> move_never <font color='#5555FF'>=</font> none_of<font color='#5555FF'>&lt;</font>move_always<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>, move_if_unreferenced<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>;

<font color='#009900'>// Detect whether returning a `type` from a cast on type's type_caster is going to result in a
</font><font color='#009900'>// reference or pointer to a local variable of the type_caster.  Basically, only
</font><font color='#009900'>// non-reference/pointer `type`s and reference/pointers from a type_caster_generic are safe;
</font><font color='#009900'>// everything else returns a reference/pointer to a local variable.
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> type<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>using</font> cast_is_temporary_value_reference
    <font color='#5555FF'>=</font> bool_constant<font color='#5555FF'>&lt;</font><font face='Lucida Console'>(</font>std::is_reference<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font>::value <font color='#5555FF'>|</font><font color='#5555FF'>|</font> std::is_pointer<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font>::value<font face='Lucida Console'>)</font>
                    <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <font color='#5555FF'>!</font>std::is_base_of<font color='#5555FF'>&lt;</font>type_caster_generic, make_caster<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>::value
                    <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <font color='#5555FF'>!</font>std::is_same<font color='#5555FF'>&lt;</font>intrinsic_t<font color='#5555FF'>&lt;</font>type<font color='#5555FF'>&gt;</font>, <font color='#0000FF'><u>void</u></font><font color='#5555FF'>&gt;</font>::value<font color='#5555FF'>&gt;</font>;

<font color='#009900'>// When a value returned from a C++ function is being cast back to Python, we almost always want to
</font><font color='#009900'>// force `policy = move`, regardless of the return value policy the function/method was declared
</font><font color='#009900'>// with.
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> Return, <font color='#0000FF'>typename</font> SFINAE <font color='#5555FF'>=</font> <font color='#0000FF'><u>void</u></font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='return_value_policy_override'></a>return_value_policy_override</b> <b>{</b>
    <font color='#0000FF'>static</font> return_value_policy <font color='#BB00BB'>policy</font><font face='Lucida Console'>(</font>return_value_policy p<font face='Lucida Console'>)</font> <b>{</b> <font color='#0000FF'>return</font> p; <b>}</b>
<b>}</b>;

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> Return<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>struct</font> <b><a name='return_value_policy_override'></a>return_value_policy_override</b><font color='#5555FF'>&lt;</font>
    Return,
    detail::enable_if_t<font color='#5555FF'>&lt;</font>std::is_base_of<font color='#5555FF'>&lt;</font>type_caster_generic, make_caster<font color='#5555FF'>&lt;</font>Return<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>::value, <font color='#0000FF'><u>void</u></font><font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font> <b>{</b>
    <font color='#0000FF'>static</font> return_value_policy <font color='#BB00BB'>policy</font><font face='Lucida Console'>(</font>return_value_policy p<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>return</font> <font color='#5555FF'>!</font>std::is_lvalue_reference<font color='#5555FF'>&lt;</font>Return<font color='#5555FF'>&gt;</font>::value <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <font color='#5555FF'>!</font>std::is_pointer<font color='#5555FF'>&lt;</font>Return<font color='#5555FF'>&gt;</font>::value
                   ? return_value_policy::move
                   : p;
    <b>}</b>
<b>}</b>;

<font color='#009900'>// Basic python -&gt; C++ casting; throws if casting fails
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T, <font color='#0000FF'>typename</font> SFINAE<font color='#5555FF'>&gt;</font>
type_caster<font color='#5555FF'>&lt;</font>T, SFINAE<font color='#5555FF'>&gt;</font> <font color='#5555FF'>&amp;</font><font color='#BB00BB'>load_type</font><font face='Lucida Console'>(</font>type_caster<font color='#5555FF'>&lt;</font>T, SFINAE<font color='#5555FF'>&gt;</font> <font color='#5555FF'>&amp;</font>conv, <font color='#0000FF'>const</font> handle <font color='#5555FF'>&amp;</font>handle<font face='Lucida Console'>)</font> <b>{</b>
    <font color='#BB00BB'>static_assert</font><font face='Lucida Console'>(</font><font color='#5555FF'>!</font>detail::is_pyobject<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value,
                  "<font color='#CC0000'>Internal error: type_caster should only be used for C++ types</font>"<font face='Lucida Console'>)</font>;
    <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>conv.<font color='#BB00BB'>load</font><font face='Lucida Console'>(</font>handle, <font color='#979000'>true</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
<font color='#0000FF'>#if</font> <font color='#5555FF'>!</font>defined<font face='Lucida Console'>(</font>PYBIND11_DETAILED_ERROR_MESSAGES<font face='Lucida Console'>)</font>
        <font color='#0000FF'>throw</font> <font color='#BB00BB'>cast_error</font><font face='Lucida Console'>(</font>
            "<font color='#CC0000'>Unable to cast Python instance of type </font>"
            <font color='#5555FF'>+</font> <font color='#BB00BB'>str</font><font face='Lucida Console'>(</font>type::<font color='#BB00BB'>handle_of</font><font face='Lucida Console'>(</font>handle<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>.cast<font color='#5555FF'>&lt;</font>std::string<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>
            <font color='#5555FF'>+</font> "<font color='#CC0000'> to C++ type '?' (#define </font>"
              "<font color='#CC0000'>PYBIND11_DETAILED_ERROR_MESSAGES or compile in debug mode for details)</font>"<font face='Lucida Console'>)</font>;
<font color='#0000FF'>#else</font>
        <font color='#0000FF'>throw</font> <font color='#BB00BB'>cast_error</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Unable to cast Python instance of type </font>"
                         <font color='#5555FF'>+</font> <font color='#BB00BB'>str</font><font face='Lucida Console'>(</font>type::<font color='#BB00BB'>handle_of</font><font face='Lucida Console'>(</font>handle<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>.cast<font color='#5555FF'>&lt;</font>std::string<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>+</font> "<font color='#CC0000'> to C++ type '</font>"
                         <font color='#5555FF'>+</font> type_id<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>+</font> "<font color='#CC0000'>'</font>"<font face='Lucida Console'>)</font>;
<font color='#0000FF'>#endif</font>
    <b>}</b>
    <font color='#0000FF'>return</font> conv;
<b>}</b>
<font color='#009900'>// Wrapper around the above that also constructs and returns a type_caster
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
make_caster<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font> <font color='#BB00BB'>load_type</font><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> handle <font color='#5555FF'>&amp;</font>handle<font face='Lucida Console'>)</font> <b>{</b>
    make_caster<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font> conv;
    <font color='#BB00BB'>load_type</font><font face='Lucida Console'>(</font>conv, handle<font face='Lucida Console'>)</font>;
    <font color='#0000FF'>return</font> conv;
<b>}</b>

<font color='#BB00BB'>PYBIND11_NAMESPACE_END</font><font face='Lucida Console'>(</font>detail<font face='Lucida Console'>)</font>

<font color='#009900'>// pytype -&gt; C++ type
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T,
          detail::enable_if_t<font color='#5555FF'>&lt;</font><font color='#5555FF'>!</font>detail::is_pyobject<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value
                                  <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <font color='#5555FF'>!</font>detail::is_same_ignoring_cvref<font color='#5555FF'>&lt;</font>T, PyObject <font color='#5555FF'>*</font><font color='#5555FF'>&gt;</font>::value,
                              <font color='#0000FF'><u>int</u></font><font color='#5555FF'>&gt;</font>
          <font color='#5555FF'>=</font> <font color='#979000'>0</font><font color='#5555FF'>&gt;</font>
T <font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> handle <font color='#5555FF'>&amp;</font>handle<font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>using</font> <font color='#0000FF'>namespace</font> detail;
    <font color='#BB00BB'>static_assert</font><font face='Lucida Console'>(</font><font color='#5555FF'>!</font>cast_is_temporary_value_reference<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value,
                  "<font color='#CC0000'>Unable to cast type to reference: value is local to type caster</font>"<font face='Lucida Console'>)</font>;
    <font color='#0000FF'>return</font> cast_op<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>load_type<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>handle<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
<b>}</b>

<font color='#009900'>// pytype -&gt; pytype (calls converting constructor)
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T, detail::enable_if_t<font color='#5555FF'>&lt;</font>detail::is_pyobject<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value, <font color='#0000FF'><u>int</u></font><font color='#5555FF'>&gt;</font> <font color='#5555FF'>=</font> <font color='#979000'>0</font><font color='#5555FF'>&gt;</font>
T <font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> handle <font color='#5555FF'>&amp;</font>handle<font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>return</font> <font color='#BB00BB'>T</font><font face='Lucida Console'>(</font>reinterpret_borrow<font color='#5555FF'>&lt;</font>object<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>handle<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
<b>}</b>

<font color='#009900'>// Note that `cast&lt;PyObject *&gt;(obj)` increments the reference count of `obj`.
</font><font color='#009900'>// This is necessary for the case that `obj` is a temporary, and could
</font><font color='#009900'>// not possibly be different, given
</font><font color='#009900'>// 1. the established convention that the passed `handle` is borrowed, and
</font><font color='#009900'>// 2. we don't want to force all generic code using `cast&lt;T&gt;()` to special-case
</font><font color='#009900'>//    handling of `T` = `PyObject *` (to increment the reference count there).
</font><font color='#009900'>// It is the responsibility of the caller to ensure that the reference count
</font><font color='#009900'>// is decremented.
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T,
          <font color='#0000FF'>typename</font> Handle,
          detail::enable_if_t<font color='#5555FF'>&lt;</font>detail::is_same_ignoring_cvref<font color='#5555FF'>&lt;</font>T, PyObject <font color='#5555FF'>*</font><font color='#5555FF'>&gt;</font>::value
                                  <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> detail::is_same_ignoring_cvref<font color='#5555FF'>&lt;</font>Handle, handle<font color='#5555FF'>&gt;</font>::value,
                              <font color='#0000FF'><u>int</u></font><font color='#5555FF'>&gt;</font>
          <font color='#5555FF'>=</font> <font color='#979000'>0</font><font color='#5555FF'>&gt;</font>
T <font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font>Handle <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>handle<font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>return</font> handle.<font color='#BB00BB'>inc_ref</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
<b>}</b>
<font color='#009900'>// To optimize way an inc_ref/dec_ref cycle:
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T,
          <font color='#0000FF'>typename</font> Object,
          detail::enable_if_t<font color='#5555FF'>&lt;</font>detail::is_same_ignoring_cvref<font color='#5555FF'>&lt;</font>T, PyObject <font color='#5555FF'>*</font><font color='#5555FF'>&gt;</font>::value
                                  <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> detail::is_same_ignoring_cvref<font color='#5555FF'>&lt;</font>Object, object<font color='#5555FF'>&gt;</font>::value,
                              <font color='#0000FF'><u>int</u></font><font color='#5555FF'>&gt;</font>
          <font color='#5555FF'>=</font> <font color='#979000'>0</font><font color='#5555FF'>&gt;</font>
T <font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font>Object <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>obj<font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>return</font> obj.<font color='#BB00BB'>release</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
<b>}</b>

<font color='#009900'>// C++ type -&gt; py::object
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T, detail::enable_if_t<font color='#5555FF'>&lt;</font><font color='#5555FF'>!</font>detail::is_pyobject<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value, <font color='#0000FF'><u>int</u></font><font color='#5555FF'>&gt;</font> <font color='#5555FF'>=</font> <font color='#979000'>0</font><font color='#5555FF'>&gt;</font>
object <font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font>T <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>value,
            return_value_policy policy <font color='#5555FF'>=</font> return_value_policy::automatic_reference,
            handle parent <font color='#5555FF'>=</font> <b><a name='handle'></a>handle</b><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>using</font> no_ref_T <font color='#5555FF'>=</font> <font color='#0000FF'>typename</font> std::remove_reference<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::type;
    <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>policy <font color='#5555FF'>=</font><font color='#5555FF'>=</font> return_value_policy::automatic<font face='Lucida Console'>)</font> <b>{</b>
        policy <font color='#5555FF'>=</font> std::is_pointer<font color='#5555FF'>&lt;</font>no_ref_T<font color='#5555FF'>&gt;</font>::value     ? return_value_policy::take_ownership
                 : std::is_lvalue_reference<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value ? return_value_policy::copy
                                                      : return_value_policy::move;
    <b>}</b> <font color='#0000FF'>else</font> <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>policy <font color='#5555FF'>=</font><font color='#5555FF'>=</font> return_value_policy::automatic_reference<font face='Lucida Console'>)</font> <b>{</b>
        policy <font color='#5555FF'>=</font> std::is_pointer<font color='#5555FF'>&lt;</font>no_ref_T<font color='#5555FF'>&gt;</font>::value     ? return_value_policy::reference
                 : std::is_lvalue_reference<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value ? return_value_policy::copy
                                                      : return_value_policy::move;
    <b>}</b>
    <font color='#0000FF'>return</font> reinterpret_steal<font color='#5555FF'>&lt;</font>object<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>
        detail::make_caster<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::<font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font>std::forward<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>value<font face='Lucida Console'>)</font>, policy, parent<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
<b>}</b>

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
T handle::<font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#0000FF'>const</font> <b>{</b>
    <font color='#0000FF'>return</font> pybind11::cast<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font color='#5555FF'>*</font><font color='#0000FF'>this</font><font face='Lucida Console'>)</font>;
<b>}</b>
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>inline</font> <font color='#0000FF'><u>void</u></font> handle::<font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#0000FF'>const</font> <b>{</b>
    <font color='#0000FF'>return</font>;
<b>}</b>

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
detail::enable_if_t<font color='#5555FF'>&lt;</font><font color='#5555FF'>!</font>detail::move_never<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value, T<font color='#5555FF'>&gt;</font> <font color='#BB00BB'>move</font><font face='Lucida Console'>(</font>object <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>obj<font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>obj.<font color='#BB00BB'>ref_count</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>&gt;</font> <font color='#979000'>1</font><font face='Lucida Console'>)</font> <b>{</b>
<font color='#0000FF'>#if</font> <font color='#5555FF'>!</font>defined<font face='Lucida Console'>(</font>PYBIND11_DETAILED_ERROR_MESSAGES<font face='Lucida Console'>)</font>
        <font color='#0000FF'>throw</font> <font color='#BB00BB'>cast_error</font><font face='Lucida Console'>(</font>
            "<font color='#CC0000'>Unable to cast Python </font>" <font color='#5555FF'>+</font> <font color='#BB00BB'>str</font><font face='Lucida Console'>(</font>type::<font color='#BB00BB'>handle_of</font><font face='Lucida Console'>(</font>obj<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>.cast<font color='#5555FF'>&lt;</font>std::string<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>
            <font color='#5555FF'>+</font> "<font color='#CC0000'> instance to C++ rvalue: instance has multiple references</font>"
              "<font color='#CC0000'> (#define PYBIND11_DETAILED_ERROR_MESSAGES or compile in debug mode for details)</font>"<font face='Lucida Console'>)</font>;
<font color='#0000FF'>#else</font>
        <font color='#0000FF'>throw</font> <font color='#BB00BB'>cast_error</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Unable to move from Python </font>"
                         <font color='#5555FF'>+</font> <font color='#BB00BB'>str</font><font face='Lucida Console'>(</font>type::<font color='#BB00BB'>handle_of</font><font face='Lucida Console'>(</font>obj<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>.cast<font color='#5555FF'>&lt;</font>std::string<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>+</font> "<font color='#CC0000'> instance to C++ </font>"
                         <font color='#5555FF'>+</font> type_id<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>+</font> "<font color='#CC0000'> instance: instance has multiple references</font>"<font face='Lucida Console'>)</font>;
<font color='#0000FF'>#endif</font>
    <b>}</b>

    <font color='#009900'>// Move into a temporary and return that, because the reference may be a local value of `conv`
</font>    T ret <font color='#5555FF'>=</font> std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font>detail::load_type<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>obj<font face='Lucida Console'>)</font>.<font color='#0000FF'>operator</font> T <font color='#5555FF'>&amp;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
    <font color='#0000FF'>return</font> ret;
<b>}</b>

<font color='#009900'>// Calling cast() on an rvalue calls pybind11::cast with the object rvalue, which does:
</font><font color='#009900'>// - If we have to move (because T has no copy constructor), do it.  This will fail if the moved
</font><font color='#009900'>//   object has multiple references, but trying to copy will fail to compile.
</font><font color='#009900'>// - If both movable and copyable, check ref count: if 1, move; otherwise copy
</font><font color='#009900'>// - Otherwise (not movable), copy.
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
detail::enable_if_t<font color='#5555FF'>&lt;</font><font color='#5555FF'>!</font>detail::is_pyobject<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> detail::move_always<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value, T<font color='#5555FF'>&gt;</font>
<font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font>object <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>object<font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>return</font> move<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font>object<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
<b>}</b>
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
detail::enable_if_t<font color='#5555FF'>&lt;</font><font color='#5555FF'>!</font>detail::is_pyobject<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> detail::move_if_unreferenced<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value, T<font color='#5555FF'>&gt;</font>
<font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font>object <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>object<font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>object.<font color='#BB00BB'>ref_count</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>&gt;</font> <font color='#979000'>1</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>return</font> cast<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>object<font face='Lucida Console'>)</font>;
    <b>}</b>
    <font color='#0000FF'>return</font> move<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font>object<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
<b>}</b>
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
detail::enable_if_t<font color='#5555FF'>&lt;</font><font color='#5555FF'>!</font>detail::is_pyobject<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> detail::move_never<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value, T<font color='#5555FF'>&gt;</font>
<font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font>object <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>object<font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>return</font> cast<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>object<font face='Lucida Console'>)</font>;
<b>}</b>

<font color='#009900'>// pytype rvalue -&gt; pytype (calls converting constructor)
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
detail::enable_if_t<font color='#5555FF'>&lt;</font>detail::is_pyobject<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value, T<font color='#5555FF'>&gt;</font> <font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font>object <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>object<font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>return</font> <font color='#BB00BB'>T</font><font face='Lucida Console'>(</font>std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font>object<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
<b>}</b>

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
T object::<font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#0000FF'>const</font> <font color='#5555FF'>&amp;</font> <b>{</b>
    <font color='#0000FF'>return</font> pybind11::cast<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font color='#5555FF'>*</font><font color='#0000FF'>this</font><font face='Lucida Console'>)</font>;
<b>}</b>
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
T object::<font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <b>{</b>
    <font color='#0000FF'>return</font> pybind11::cast<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font><font color='#5555FF'>*</font><font color='#0000FF'>this</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
<b>}</b>
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>inline</font> <font color='#0000FF'><u>void</u></font> object::<font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#0000FF'>const</font> <font color='#5555FF'>&amp;</font> <b>{</b>
    <font color='#0000FF'>return</font>;
<b>}</b>
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>inline</font> <font color='#0000FF'><u>void</u></font> object::<font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <b>{</b>
    <font color='#0000FF'>return</font>;
<b>}</b>

<font color='#BB00BB'>PYBIND11_NAMESPACE_BEGIN</font><font face='Lucida Console'>(</font>detail<font face='Lucida Console'>)</font>

<font color='#009900'>// Declared in pytypes.h:
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T, enable_if_t<font color='#5555FF'>&lt;</font><font color='#5555FF'>!</font>is_pyobject<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value, <font color='#0000FF'><u>int</u></font><font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>
object <font color='#BB00BB'>object_or_cast</font><font face='Lucida Console'>(</font>T <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>o<font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>return</font> pybind11::<font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font>std::forward<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>o<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
<b>}</b>

<font color='#009900'>// Placeholder type for the unneeded (and dead code) static variable in the
</font><font color='#009900'>// PYBIND11_OVERRIDE_OVERRIDE macro
</font><font color='#0000FF'>struct</font> <b><a name='override_unused'></a>override_unused</b> <b>{</b><b>}</b>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> ret_type<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>using</font> override_caster_t <font color='#5555FF'>=</font> conditional_t<font color='#5555FF'>&lt;</font>cast_is_temporary_value_reference<font color='#5555FF'>&lt;</font>ret_type<font color='#5555FF'>&gt;</font>::value,
                                        make_caster<font color='#5555FF'>&lt;</font>ret_type<font color='#5555FF'>&gt;</font>,
                                        override_unused<font color='#5555FF'>&gt;</font>;

<font color='#009900'>// Trampoline use: for reference/pointer types to value-converted values, we do a value cast, then
</font><font color='#009900'>// store the result in the given variable.  For other types, this is a no-op.
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
enable_if_t<font color='#5555FF'>&lt;</font>cast_is_temporary_value_reference<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value, T<font color='#5555FF'>&gt;</font> <font color='#BB00BB'>cast_ref</font><font face='Lucida Console'>(</font>object <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>o,
                                                                     make_caster<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font> <font color='#5555FF'>&amp;</font>caster<font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>return</font> cast_op<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font color='#BB00BB'>load_type</font><font face='Lucida Console'>(</font>caster, o<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
<b>}</b>
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
enable_if_t<font color='#5555FF'>&lt;</font><font color='#5555FF'>!</font>cast_is_temporary_value_reference<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value, T<font color='#5555FF'>&gt;</font> <font color='#BB00BB'>cast_ref</font><font face='Lucida Console'>(</font>object <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>,
                                                                      override_unused <font color='#5555FF'>&amp;</font><font face='Lucida Console'>)</font> <b>{</b>
    <font color='#BB00BB'>pybind11_fail</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Internal error: cast_ref fallback invoked</font>"<font face='Lucida Console'>)</font>;
<b>}</b>

<font color='#009900'>// Trampoline use: Having a pybind11::cast with an invalid reference type is going to
</font><font color='#009900'>// static_assert, even though if it's in dead code, so we provide a "trampoline" to pybind11::cast
</font><font color='#009900'>// that only does anything in cases where pybind11::cast is valid.
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
enable_if_t<font color='#5555FF'>&lt;</font>cast_is_temporary_value_reference<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value, T<font color='#5555FF'>&gt;</font> <font color='#BB00BB'>cast_safe</font><font face='Lucida Console'>(</font>object <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font><font face='Lucida Console'>)</font> <b>{</b>
    <font color='#BB00BB'>pybind11_fail</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Internal error: cast_safe fallback invoked</font>"<font face='Lucida Console'>)</font>;
<b>}</b>
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
enable_if_t<font color='#5555FF'>&lt;</font>std::is_void<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::value, <font color='#0000FF'><u>void</u></font><font color='#5555FF'>&gt;</font> <font color='#BB00BB'>cast_safe</font><font face='Lucida Console'>(</font>object <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font><font face='Lucida Console'>)</font> <b>{</b><b>}</b>
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
enable_if_t<font color='#5555FF'>&lt;</font>detail::none_of<font color='#5555FF'>&lt;</font>cast_is_temporary_value_reference<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>, std::is_void<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>::value, T<font color='#5555FF'>&gt;</font>
<font color='#BB00BB'>cast_safe</font><font face='Lucida Console'>(</font>object <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>o<font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>return</font> pybind11::cast<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font>o<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
<b>}</b>

<font color='#BB00BB'>PYBIND11_NAMESPACE_END</font><font face='Lucida Console'>(</font>detail<font face='Lucida Console'>)</font>

<font color='#009900'>// The overloads could coexist, i.e. the #if is not strictly speaking needed,
</font><font color='#009900'>// but it is an easy minor optimization.
</font><font color='#0000FF'>#if</font> <font color='#5555FF'>!</font>defined<font face='Lucida Console'>(</font>PYBIND11_DETAILED_ERROR_MESSAGES<font face='Lucida Console'>)</font>
<font color='#0000FF'>inline</font> cast_error <font color='#BB00BB'>cast_error_unable_to_convert_call_arg</font><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> std::string <font color='#5555FF'>&amp;</font>name<font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>return</font> <font color='#BB00BB'>cast_error</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Unable to convert call argument '</font>" <font color='#5555FF'>+</font> name
                      <font color='#5555FF'>+</font> "<font color='#CC0000'>' to Python object (#define </font>"
                        "<font color='#CC0000'>PYBIND11_DETAILED_ERROR_MESSAGES or compile in debug mode for details)</font>"<font face='Lucida Console'>)</font>;
<b>}</b>
<font color='#0000FF'>#else</font>
<font color='#0000FF'>inline</font> cast_error <font color='#BB00BB'>cast_error_unable_to_convert_call_arg</font><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> std::string <font color='#5555FF'>&amp;</font>name,
                                                        <font color='#0000FF'>const</font> std::string <font color='#5555FF'>&amp;</font>type<font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>return</font> <font color='#BB00BB'>cast_error</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Unable to convert call argument '</font>" <font color='#5555FF'>+</font> name <font color='#5555FF'>+</font> "<font color='#CC0000'>' of type '</font>" <font color='#5555FF'>+</font> type
                      <font color='#5555FF'>+</font> "<font color='#CC0000'>' to Python object</font>"<font face='Lucida Console'>)</font>;
<b>}</b>
<font color='#0000FF'>#endif</font>

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font>return_value_policy policy <font color='#5555FF'>=</font> return_value_policy::automatic_reference<font color='#5555FF'>&gt;</font>
tuple <font color='#BB00BB'>make_tuple</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>return</font> <font color='#BB00BB'>tuple</font><font face='Lucida Console'>(</font><font color='#979000'>0</font><font face='Lucida Console'>)</font>;
<b>}</b>

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font>return_value_policy policy <font color='#5555FF'>=</font> return_value_policy::automatic_reference, <font color='#0000FF'>typename</font>... Args<font color='#5555FF'>&gt;</font>
tuple <font color='#BB00BB'>make_tuple</font><font face='Lucida Console'>(</font>Args <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>...args_<font face='Lucida Console'>)</font> <b>{</b>
    constexpr <font color='#0000FF'><u>size_t</u></font> size <font color='#5555FF'>=</font> <font color='#0000FF'>sizeof</font>...<font face='Lucida Console'>(</font>Args<font face='Lucida Console'>)</font>;
    std::array<font color='#5555FF'>&lt;</font>object, size<font color='#5555FF'>&gt;</font> args<b>{</b><b>{</b>reinterpret_steal<font color='#5555FF'>&lt;</font>object<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>
        detail::make_caster<font color='#5555FF'>&lt;</font>Args<font color='#5555FF'>&gt;</font>::<font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font>std::forward<font color='#5555FF'>&lt;</font>Args<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>args_<font face='Lucida Console'>)</font>, policy, nullptr<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>...<b>}</b><b>}</b>;
    <font color='#0000FF'>for</font> <font face='Lucida Console'>(</font><font color='#0000FF'><u>size_t</u></font> i <font color='#5555FF'>=</font> <font color='#979000'>0</font>; i <font color='#5555FF'>&lt;</font> args.<font color='#BB00BB'>size</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>; i<font color='#5555FF'>+</font><font color='#5555FF'>+</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>args[i]<font face='Lucida Console'>)</font> <b>{</b>
<font color='#0000FF'>#if</font> <font color='#5555FF'>!</font>defined<font face='Lucida Console'>(</font>PYBIND11_DETAILED_ERROR_MESSAGES<font face='Lucida Console'>)</font>
            <font color='#0000FF'>throw</font> <font color='#BB00BB'>cast_error_unable_to_convert_call_arg</font><font face='Lucida Console'>(</font>std::<font color='#BB00BB'>to_string</font><font face='Lucida Console'>(</font>i<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
<font color='#0000FF'>#else</font>
            std::array<font color='#5555FF'>&lt;</font>std::string, size<font color='#5555FF'>&gt;</font> argtypes<b>{</b><b>{</b>type_id<font color='#5555FF'>&lt;</font>Args<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>...<b>}</b><b>}</b>;
            <font color='#0000FF'>throw</font> <font color='#BB00BB'>cast_error_unable_to_convert_call_arg</font><font face='Lucida Console'>(</font>std::<font color='#BB00BB'>to_string</font><font face='Lucida Console'>(</font>i<font face='Lucida Console'>)</font>, argtypes[i]<font face='Lucida Console'>)</font>;
<font color='#0000FF'>#endif</font>
        <b>}</b>
    <b>}</b>
    tuple <font color='#BB00BB'>result</font><font face='Lucida Console'>(</font>size<font face='Lucida Console'>)</font>;
    <font color='#0000FF'><u>int</u></font> counter <font color='#5555FF'>=</font> <font color='#979000'>0</font>;
    <font color='#0000FF'>for</font> <font face='Lucida Console'>(</font><font color='#0000FF'>auto</font> <font color='#5555FF'>&amp;</font>arg_value : args<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#BB00BB'>PyTuple_SET_ITEM</font><font face='Lucida Console'>(</font>result.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>, counter<font color='#5555FF'>+</font><font color='#5555FF'>+</font>, arg_value.<font color='#BB00BB'>release</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
    <b>}</b>
    <font color='#0000FF'>return</font> result;
<b>}</b>

<font color='#009900'>/// \ingroup annotations
</font><font color='#009900'>/// Annotation for arguments
</font><font color='#0000FF'>struct</font> <b><a name='arg'></a>arg</b> <b>{</b>
    <font color='#009900'>/// Constructs an argument with the name of the argument; if null or omitted, this is a
</font>    <font color='#009900'>/// positional argument.
</font>    constexpr <font color='#0000FF'>explicit</font> <font color='#BB00BB'>arg</font><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> <font color='#0000FF'><u>char</u></font> <font color='#5555FF'>*</font>name <font color='#5555FF'>=</font> nullptr<font face='Lucida Console'>)</font>
        : name<font face='Lucida Console'>(</font>name<font face='Lucida Console'>)</font>, flag_noconvert<font face='Lucida Console'>(</font><font color='#979000'>false</font><font face='Lucida Console'>)</font>, flag_none<font face='Lucida Console'>(</font><font color='#979000'>true</font><font face='Lucida Console'>)</font> <b>{</b><b>}</b>
    <font color='#009900'>/// Assign a value to this argument
</font>    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
    arg_v <b><a name='operator'></a>operator</b><font color='#5555FF'>=</font><font face='Lucida Console'>(</font>T <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>value<font face='Lucida Console'>)</font> <font color='#0000FF'>const</font>;
    <font color='#009900'>/// Indicate that the type should not be converted in the type caster
</font>    arg <font color='#5555FF'>&amp;</font><font color='#BB00BB'>noconvert</font><font face='Lucida Console'>(</font><font color='#0000FF'><u>bool</u></font> flag <font color='#5555FF'>=</font> <font color='#979000'>true</font><font face='Lucida Console'>)</font> <b>{</b>
        flag_noconvert <font color='#5555FF'>=</font> flag;
        <font color='#0000FF'>return</font> <font color='#5555FF'>*</font><font color='#0000FF'>this</font>;
    <b>}</b>
    <font color='#009900'>/// Indicates that the argument should/shouldn't allow None (e.g. for nullable pointer args)
</font>    arg <font color='#5555FF'>&amp;</font><font color='#BB00BB'>none</font><font face='Lucida Console'>(</font><font color='#0000FF'><u>bool</u></font> flag <font color='#5555FF'>=</font> <font color='#979000'>true</font><font face='Lucida Console'>)</font> <b>{</b>
        flag_none <font color='#5555FF'>=</font> flag;
        <font color='#0000FF'>return</font> <font color='#5555FF'>*</font><font color='#0000FF'>this</font>;
    <b>}</b>

    <font color='#0000FF'>const</font> <font color='#0000FF'><u>char</u></font> <font color='#5555FF'>*</font>name;        <font color='#009900'>///&lt; If non-null, this is a named kwargs argument
</font>    <font color='#0000FF'><u>bool</u></font> flag_noconvert : <font color='#979000'>1</font>; <font color='#009900'>///&lt; If set, do not allow conversion (requires a supporting type
</font>                             <font color='#009900'>///&lt; caster!)
</font>    <font color='#0000FF'><u>bool</u></font> flag_none : <font color='#979000'>1</font>;      <font color='#009900'>///&lt; If set (the default), allow None to be passed to this argument
</font><b>}</b>;

<font color='#009900'>/// \ingroup annotations
</font><font color='#009900'>/// Annotation for arguments with values
</font><font color='#0000FF'>struct</font> <b><a name='arg_v'></a>arg_v</b> : arg <b>{</b>
<font color='#0000FF'>private</font>:
    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
    <font color='#BB00BB'>arg_v</font><font face='Lucida Console'>(</font>arg <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>base, T <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>x, <font color='#0000FF'>const</font> <font color='#0000FF'><u>char</u></font> <font color='#5555FF'>*</font>descr <font color='#5555FF'>=</font> nullptr<font face='Lucida Console'>)</font>
        : arg<font face='Lucida Console'>(</font>base<font face='Lucida Console'>)</font>, value<font face='Lucida Console'>(</font>reinterpret_steal<font color='#5555FF'>&lt;</font>object<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>detail::make_caster<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::cast<font face='Lucida Console'>(</font>
                         std::forward<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>x<font face='Lucida Console'>)</font>, return_value_policy::automatic, <b>{</b><b>}</b><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>,
          <font color='#BB00BB'>descr</font><font face='Lucida Console'>(</font>descr<font face='Lucida Console'>)</font>
<font color='#0000FF'>#if</font> defined<font face='Lucida Console'>(</font>PYBIND11_DETAILED_ERROR_MESSAGES<font face='Lucida Console'>)</font>
          ,
          <font color='#BB00BB'>type</font><font face='Lucida Console'>(</font>type_id<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>
<font color='#0000FF'>#endif</font>
    <b>{</b>
        <font color='#009900'>// Workaround! See:
</font>        <font color='#009900'>// https://github.com/pybind/pybind11/issues/2336
</font>        <font color='#009900'>// https://github.com/pybind/pybind11/pull/2685#issuecomment-731286700
</font>        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#BB00BB'>PyErr_Occurred</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
            <font color='#BB00BB'>PyErr_Clear</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
        <b>}</b>
    <b>}</b>

<font color='#0000FF'>public</font>:
    <font color='#009900'>/// Direct construction with name, default, and description
</font>    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
    <font color='#BB00BB'>arg_v</font><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> <font color='#0000FF'><u>char</u></font> <font color='#5555FF'>*</font>name, T <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>x, <font color='#0000FF'>const</font> <font color='#0000FF'><u>char</u></font> <font color='#5555FF'>*</font>descr <font color='#5555FF'>=</font> nullptr<font face='Lucida Console'>)</font>
        : arg_v<font face='Lucida Console'>(</font>arg<font face='Lucida Console'>(</font>name<font face='Lucida Console'>)</font>, std::forward<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>x<font face='Lucida Console'>)</font>, descr<font face='Lucida Console'>)</font> <b>{</b><b>}</b>

    <font color='#009900'>/// Called internally when invoking `py::arg("a") = value`
</font>    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
    <font color='#BB00BB'>arg_v</font><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> arg <font color='#5555FF'>&amp;</font>base, T <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>x, <font color='#0000FF'>const</font> <font color='#0000FF'><u>char</u></font> <font color='#5555FF'>*</font>descr <font color='#5555FF'>=</font> nullptr<font face='Lucida Console'>)</font>
        : arg_v<font face='Lucida Console'>(</font>arg<font face='Lucida Console'>(</font>base<font face='Lucida Console'>)</font>, std::forward<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>x<font face='Lucida Console'>)</font>, descr<font face='Lucida Console'>)</font> <b>{</b><b>}</b>

    <font color='#009900'>/// Same as `arg::noconvert()`, but returns *this as arg_v&amp;, not arg&amp;
</font>    arg_v <font color='#5555FF'>&amp;</font><font color='#BB00BB'>noconvert</font><font face='Lucida Console'>(</font><font color='#0000FF'><u>bool</u></font> flag <font color='#5555FF'>=</font> <font color='#979000'>true</font><font face='Lucida Console'>)</font> <b>{</b>
        arg::<font color='#BB00BB'>noconvert</font><font face='Lucida Console'>(</font>flag<font face='Lucida Console'>)</font>;
        <font color='#0000FF'>return</font> <font color='#5555FF'>*</font><font color='#0000FF'>this</font>;
    <b>}</b>

    <font color='#009900'>/// Same as `arg::nonone()`, but returns *this as arg_v&amp;, not arg&amp;
</font>    arg_v <font color='#5555FF'>&amp;</font><font color='#BB00BB'>none</font><font face='Lucida Console'>(</font><font color='#0000FF'><u>bool</u></font> flag <font color='#5555FF'>=</font> <font color='#979000'>true</font><font face='Lucida Console'>)</font> <b>{</b>
        arg::<font color='#BB00BB'>none</font><font face='Lucida Console'>(</font>flag<font face='Lucida Console'>)</font>;
        <font color='#0000FF'>return</font> <font color='#5555FF'>*</font><font color='#0000FF'>this</font>;
    <b>}</b>

    <font color='#009900'>/// The default value
</font>    object value;
    <font color='#009900'>/// The (optional) description of the default value
</font>    <font color='#0000FF'>const</font> <font color='#0000FF'><u>char</u></font> <font color='#5555FF'>*</font>descr;
<font color='#0000FF'>#if</font> defined<font face='Lucida Console'>(</font>PYBIND11_DETAILED_ERROR_MESSAGES<font face='Lucida Console'>)</font>
    <font color='#009900'>/// The C++ type name of the default value (only available when compiled in debug mode)
</font>    std::string type;
<font color='#0000FF'>#endif</font>
<b>}</b>;

<font color='#009900'>/// \ingroup annotations
</font><font color='#009900'>/// Annotation indicating that all following arguments are keyword-only; the is the equivalent of
</font><font color='#009900'>/// an unnamed '*' argument
</font><font color='#0000FF'>struct</font> <b><a name='kw_only'></a>kw_only</b> <b>{</b><b>}</b>;

<font color='#009900'>/// \ingroup annotations
</font><font color='#009900'>/// Annotation indicating that all previous arguments are positional-only; the is the equivalent of
</font><font color='#009900'>/// an unnamed '/' argument (in Python 3.8)
</font><font color='#0000FF'>struct</font> <b><a name='pos_only'></a>pos_only</b> <b>{</b><b>}</b>;

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
arg_v arg::<b><a name='operator'></a>operator</b><font color='#5555FF'>=</font><font face='Lucida Console'>(</font>T <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>value<font face='Lucida Console'>)</font> <font color='#0000FF'>const</font> <b>{</b>
    <font color='#0000FF'>return</font> <b>{</b><font color='#5555FF'>*</font><font color='#0000FF'>this</font>, std::forward<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>value<font face='Lucida Console'>)</font><b>}</b>;
<b>}</b>

<font color='#009900'>/// Alias for backward compatibility -- to be removed in version 2.0
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> <font color='#009900'>/*unused*/</font><font color='#5555FF'>&gt;</font>
<font color='#0000FF'>using</font> arg_t <font color='#5555FF'>=</font> arg_v;

<font color='#0000FF'>inline</font> <font color='#0000FF'>namespace</font> literals <b>{</b>
<font color='#009900'>/** \rst
    String literal version of `arg`
 \endrst */</font>
constexpr arg
<font color='#0000FF'>#if</font> <font color='#5555FF'>!</font>defined<font face='Lucida Console'>(</font>__clang__<font face='Lucida Console'>)</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> defined<font face='Lucida Console'>(</font>__GNUC__<font face='Lucida Console'>)</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> __GNUC__ <font color='#5555FF'>&lt;</font> <font color='#979000'>5</font>
<b><a name='operator'></a>operator</b>"<font color='#CC0000'></font>" _a <font color='#009900'>// gcc 4.8.5 insists on having a space (hard error).
</font><font color='#0000FF'>#else</font>
<b><a name='operator'></a>operator</b>"<font color='#CC0000'></font>"_a <font color='#009900'>// clang 17 generates a deprecation warning if there is a space.
</font><font color='#0000FF'>#endif</font>
    <font face='Lucida Console'>(</font><font color='#0000FF'>const</font> <font color='#0000FF'><u>char</u></font> <font color='#5555FF'>*</font>name, <font color='#0000FF'><u>size_t</u></font><font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>return</font> <font color='#BB00BB'>arg</font><font face='Lucida Console'>(</font>name<font face='Lucida Console'>)</font>;
<b>}</b>
<b>}</b> <font color='#009900'>// namespace literals
</font>
<font color='#BB00BB'>PYBIND11_NAMESPACE_BEGIN</font><font face='Lucida Console'>(</font>detail<font face='Lucida Console'>)</font>

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>using</font> is_kw_only <font color='#5555FF'>=</font> std::is_same<font color='#5555FF'>&lt;</font>intrinsic_t<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>, kw_only<font color='#5555FF'>&gt;</font>;
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>using</font> is_pos_only <font color='#5555FF'>=</font> std::is_same<font color='#5555FF'>&lt;</font>intrinsic_t<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>, pos_only<font color='#5555FF'>&gt;</font>;

<font color='#009900'>// forward declaration (definition in attr.h)
</font><font color='#0000FF'>struct</font> <b><a name='function_record'></a>function_record</b>;

<font color='#009900'>/// Internal data associated with a single function call
</font><font color='#0000FF'>struct</font> <b><a name='function_call'></a>function_call</b> <b>{</b>
    <font color='#BB00BB'>function_call</font><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> function_record <font color='#5555FF'>&amp;</font>f, handle p<font face='Lucida Console'>)</font>; <font color='#009900'>// Implementation in attr.h
</font>
    <font color='#009900'>/// The function data:
</font>    <font color='#0000FF'>const</font> function_record <font color='#5555FF'>&amp;</font>func;

    <font color='#009900'>/// Arguments passed to the function:
</font>    std::vector<font color='#5555FF'>&lt;</font>handle<font color='#5555FF'>&gt;</font> args;

    <font color='#009900'>/// The `convert` value the arguments should be loaded with
</font>    std::vector<font color='#5555FF'>&lt;</font><font color='#0000FF'><u>bool</u></font><font color='#5555FF'>&gt;</font> args_convert;

    <font color='#009900'>/// Extra references for the optional `py::args` and/or `py::kwargs` arguments (which, if
</font>    <font color='#009900'>/// present, are also in `args` but without a reference).
</font>    object args_ref, kwargs_ref;

    <font color='#009900'>/// The parent, if any
</font>    handle parent;

    <font color='#009900'>/// If this is a call to an initializer, this argument contains `self`
</font>    handle init_self;
<b>}</b>;

<font color='#009900'>/// Helper class which loads arguments for C++ functions called from Python
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font>... Args<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>class</font> <b><a name='argument_loader'></a>argument_loader</b> <b>{</b>
    <font color='#0000FF'>using</font> indices <font color='#5555FF'>=</font> make_index_sequence<font color='#5555FF'>&lt;</font><font color='#0000FF'>sizeof</font>...<font face='Lucida Console'>(</font>Args<font face='Lucida Console'>)</font><font color='#5555FF'>&gt;</font>;

    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> Arg<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'>using</font> argument_is_args <font color='#5555FF'>=</font> std::is_same<font color='#5555FF'>&lt;</font>intrinsic_t<font color='#5555FF'>&lt;</font>Arg<font color='#5555FF'>&gt;</font>, args<font color='#5555FF'>&gt;</font>;
    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> Arg<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'>using</font> argument_is_kwargs <font color='#5555FF'>=</font> std::is_same<font color='#5555FF'>&lt;</font>intrinsic_t<font color='#5555FF'>&lt;</font>Arg<font color='#5555FF'>&gt;</font>, kwargs<font color='#5555FF'>&gt;</font>;
    <font color='#009900'>// Get kwargs argument position, or -1 if not present:
</font>    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> kwargs_pos <font color='#5555FF'>=</font> constexpr_last<font color='#5555FF'>&lt;</font>argument_is_kwargs, Args...<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;

    <font color='#BB00BB'>static_assert</font><font face='Lucida Console'>(</font>kwargs_pos <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#5555FF'>-</font><font color='#979000'>1</font> <font color='#5555FF'>|</font><font color='#5555FF'>|</font> kwargs_pos <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font face='Lucida Console'>(</font><font color='#0000FF'><u>int</u></font><font face='Lucida Console'>)</font> <font color='#0000FF'>sizeof</font>...<font face='Lucida Console'>(</font>Args<font face='Lucida Console'>)</font> <font color='#5555FF'>-</font> <font color='#979000'>1</font>,
                  "<font color='#CC0000'>py::kwargs is only permitted as the last argument of a function</font>"<font face='Lucida Console'>)</font>;

<font color='#0000FF'>public</font>:
    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'><u>bool</u></font> has_kwargs <font color='#5555FF'>=</font> kwargs_pos <font color='#5555FF'>!</font><font color='#5555FF'>=</font> <font color='#5555FF'>-</font><font color='#979000'>1</font>;

    <font color='#009900'>// py::args argument position; -1 if not present.
</font>    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'><u>int</u></font> args_pos <font color='#5555FF'>=</font> constexpr_last<font color='#5555FF'>&lt;</font>argument_is_args, Args...<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;

    <font color='#BB00BB'>static_assert</font><font face='Lucida Console'>(</font>args_pos <font color='#5555FF'>=</font><font color='#5555FF'>=</font> <font color='#5555FF'>-</font><font color='#979000'>1</font> <font color='#5555FF'>|</font><font color='#5555FF'>|</font> args_pos <font color='#5555FF'>=</font><font color='#5555FF'>=</font> constexpr_first<font color='#5555FF'>&lt;</font>argument_is_args, Args...<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>,
                  "<font color='#CC0000'>py::args cannot be specified more than once</font>"<font face='Lucida Console'>)</font>;

    <font color='#0000FF'>static</font> constexpr <font color='#0000FF'>auto</font> arg_names
        <font color='#5555FF'>=</font> ::pybind11::detail::<font color='#BB00BB'>concat</font><font face='Lucida Console'>(</font><b><a name='type_descr'></a>type_descr</b><font face='Lucida Console'>(</font>make_caster<font color='#5555FF'>&lt;</font>Args<font color='#5555FF'>&gt;</font>::name<font face='Lucida Console'>)</font>...<font face='Lucida Console'>)</font>;

    <font color='#0000FF'><u>bool</u></font> <font color='#BB00BB'>load_args</font><font face='Lucida Console'>(</font>function_call <font color='#5555FF'>&amp;</font>call<font face='Lucida Console'>)</font> <b>{</b> <font color='#0000FF'>return</font> <font color='#BB00BB'>load_impl_sequence</font><font face='Lucida Console'>(</font>call, indices<b>{</b><b>}</b><font face='Lucida Console'>)</font>; <b>}</b>

    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> Return, <font color='#0000FF'>typename</font> Guard, <font color='#0000FF'>typename</font> Func<font color='#5555FF'>&gt;</font>
    <font color='#009900'>// NOLINTNEXTLINE(readability-const-return-type)
</font>    enable_if_t<font color='#5555FF'>&lt;</font><font color='#5555FF'>!</font>std::is_void<font color='#5555FF'>&lt;</font>Return<font color='#5555FF'>&gt;</font>::value, Return<font color='#5555FF'>&gt;</font> <font color='#BB00BB'>call</font><font face='Lucida Console'>(</font>Func <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>f<font face='Lucida Console'>)</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <b>{</b>
        <font color='#0000FF'>return</font> std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font><font color='#5555FF'>*</font><font color='#0000FF'>this</font><font face='Lucida Console'>)</font>.<font color='#0000FF'>template</font> call_impl<font color='#5555FF'>&lt;</font>remove_cv_t<font color='#5555FF'>&lt;</font>Return<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>
            std::forward<font color='#5555FF'>&lt;</font>Func<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>f<font face='Lucida Console'>)</font>, indices<b>{</b><b>}</b>, Guard<b>{</b><b>}</b><font face='Lucida Console'>)</font>;
    <b>}</b>

    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> Return, <font color='#0000FF'>typename</font> Guard, <font color='#0000FF'>typename</font> Func<font color='#5555FF'>&gt;</font>
    enable_if_t<font color='#5555FF'>&lt;</font>std::is_void<font color='#5555FF'>&lt;</font>Return<font color='#5555FF'>&gt;</font>::value, void_type<font color='#5555FF'>&gt;</font> <font color='#BB00BB'>call</font><font face='Lucida Console'>(</font>Func <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>f<font face='Lucida Console'>)</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <b>{</b>
        std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font><font color='#5555FF'>*</font><font color='#0000FF'>this</font><font face='Lucida Console'>)</font>.<font color='#0000FF'>template</font> call_impl<font color='#5555FF'>&lt;</font>remove_cv_t<font color='#5555FF'>&lt;</font>Return<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>
            std::forward<font color='#5555FF'>&lt;</font>Func<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>f<font face='Lucida Console'>)</font>, indices<b>{</b><b>}</b>, Guard<b>{</b><b>}</b><font face='Lucida Console'>)</font>;
        <font color='#0000FF'>return</font> <font color='#BB00BB'>void_type</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
    <b>}</b>

<font color='#0000FF'>private</font>:
    <font color='#0000FF'>static</font> <font color='#0000FF'><u>bool</u></font> <font color='#BB00BB'>load_impl_sequence</font><font face='Lucida Console'>(</font>function_call <font color='#5555FF'>&amp;</font>, index_sequence<font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font><font face='Lucida Console'>)</font> <b>{</b> <font color='#0000FF'>return</font> <font color='#979000'>true</font>; <b>}</b>

    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'><u>size_t</u></font>... Is<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'><u>bool</u></font> <font color='#BB00BB'>load_impl_sequence</font><font face='Lucida Console'>(</font>function_call <font color='#5555FF'>&amp;</font>call, index_sequence<font color='#5555FF'>&lt;</font>Is...<font color='#5555FF'>&gt;</font><font face='Lucida Console'>)</font> <b>{</b>
<font color='#0000FF'>#ifdef</font> __cpp_fold_expressions
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font face='Lucida Console'>(</font>... <font color='#5555FF'>|</font><font color='#5555FF'>|</font> <font color='#5555FF'>!</font>std::get<font color='#5555FF'>&lt;</font>Is<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>argcasters<font face='Lucida Console'>)</font>.<font color='#BB00BB'>load</font><font face='Lucida Console'>(</font>call.args[Is], call.args_convert[Is]<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
        <b>}</b>
<font color='#0000FF'>#else</font>
        <font color='#0000FF'>for</font> <font face='Lucida Console'>(</font><font color='#0000FF'><u>bool</u></font> r : <b>{</b>std::get<font color='#5555FF'>&lt;</font>Is<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>argcasters<font face='Lucida Console'>)</font>.<font color='#BB00BB'>load</font><font face='Lucida Console'>(</font>call.args[Is], call.args_convert[Is]<font face='Lucida Console'>)</font>...<b>}</b><font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>r<font face='Lucida Console'>)</font> <b>{</b>
                <font color='#0000FF'>return</font> <font color='#979000'>false</font>;
            <b>}</b>
        <b>}</b>
<font color='#0000FF'>#endif</font>
        <font color='#0000FF'>return</font> <font color='#979000'>true</font>;
    <b>}</b>

    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> Return, <font color='#0000FF'>typename</font> Func, <font color='#0000FF'><u>size_t</u></font>... Is, <font color='#0000FF'>typename</font> Guard<font color='#5555FF'>&gt;</font>
    Return <font color='#BB00BB'>call_impl</font><font face='Lucida Console'>(</font>Func <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>f, index_sequence<font color='#5555FF'>&lt;</font>Is...<font color='#5555FF'>&gt;</font>, Guard <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font><font face='Lucida Console'>)</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <b>{</b>
        <font color='#0000FF'>return</font> std::forward<font color='#5555FF'>&lt;</font>Func<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>f<font face='Lucida Console'>)</font><font face='Lucida Console'>(</font>cast_op<font color='#5555FF'>&lt;</font>Args<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font>std::get<font color='#5555FF'>&lt;</font>Is<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>argcasters<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>...<font face='Lucida Console'>)</font>;
    <b>}</b>

    std::tuple<font color='#5555FF'>&lt;</font>make_caster<font color='#5555FF'>&lt;</font>Args<font color='#5555FF'>&gt;</font>...<font color='#5555FF'>&gt;</font> argcasters;
<b>}</b>;

<font color='#009900'>/// Helper class which collects only positional arguments for a Python function call.
</font><font color='#009900'>/// A fancier version below can collect any argument, but this one is optimal for simple calls.
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font>return_value_policy policy<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>class</font> <b><a name='simple_collector'></a>simple_collector</b> <b>{</b>
<font color='#0000FF'>public</font>:
    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font>... Ts<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'>explicit</font> <font color='#BB00BB'>simple_collector</font><font face='Lucida Console'>(</font>Ts <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>...values<font face='Lucida Console'>)</font>
        : m_args<font face='Lucida Console'>(</font>pybind11::make_tuple<font color='#5555FF'>&lt;</font>policy<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>std::forward<font color='#5555FF'>&lt;</font>Ts<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>values<font face='Lucida Console'>)</font>...<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b><b>}</b>

    <font color='#0000FF'>const</font> tuple <font color='#5555FF'>&amp;</font><font color='#BB00BB'>args</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#0000FF'>const</font> <font color='#5555FF'>&amp;</font> <b>{</b> <font color='#0000FF'>return</font> m_args; <b>}</b>
    dict <font color='#BB00BB'>kwargs</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#0000FF'>const</font> <b>{</b> <font color='#0000FF'>return</font> <b>{</b><b>}</b>; <b>}</b>

    tuple <font color='#BB00BB'>args</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <b>{</b> <font color='#0000FF'>return</font> std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font>m_args<font face='Lucida Console'>)</font>; <b>}</b>

    <font color='#009900'>/// Call a Python function and pass the collected arguments
</font>    object <font color='#BB00BB'>call</font><font face='Lucida Console'>(</font>PyObject <font color='#5555FF'>*</font>ptr<font face='Lucida Console'>)</font> <font color='#0000FF'>const</font> <b>{</b>
        PyObject <font color='#5555FF'>*</font>result <font color='#5555FF'>=</font> <font color='#BB00BB'>PyObject_CallObject</font><font face='Lucida Console'>(</font>ptr, m_args.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>result<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>throw</font> <font color='#BB00BB'>error_already_set</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
        <b>}</b>
        <font color='#0000FF'>return</font> reinterpret_steal<font color='#5555FF'>&lt;</font>object<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>result<font face='Lucida Console'>)</font>;
    <b>}</b>

<font color='#0000FF'>private</font>:
    tuple m_args;
<b>}</b>;

<font color='#009900'>/// Helper class which collects positional, keyword, * and ** arguments for a Python function call
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font>return_value_policy policy<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>class</font> <b><a name='unpacking_collector'></a>unpacking_collector</b> <b>{</b>
<font color='#0000FF'>public</font>:
    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font>... Ts<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'>explicit</font> <font color='#BB00BB'>unpacking_collector</font><font face='Lucida Console'>(</font>Ts <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>...values<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#009900'>// Tuples aren't (easily) resizable so a list is needed for collection,
</font>        <font color='#009900'>// but the actual function call strictly requires a tuple.
</font>        <font color='#0000FF'>auto</font> args_list <font color='#5555FF'>=</font> <font color='#BB00BB'>list</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
        <font color='#0000FF'>using</font> expander <font color='#5555FF'>=</font> <font color='#0000FF'><u>int</u></font>[];
        <font face='Lucida Console'>(</font><font color='#0000FF'><u>void</u></font><font face='Lucida Console'>)</font> expander<b>{</b><font color='#979000'>0</font>, <font face='Lucida Console'>(</font><font color='#BB00BB'>process</font><font face='Lucida Console'>(</font>args_list, std::forward<font color='#5555FF'>&lt;</font>Ts<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>values<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>, <font color='#979000'>0</font><font face='Lucida Console'>)</font>...<b>}</b>;

        m_args <font color='#5555FF'>=</font> std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font>args_list<font face='Lucida Console'>)</font>;
    <b>}</b>

    <font color='#0000FF'>const</font> tuple <font color='#5555FF'>&amp;</font><font color='#BB00BB'>args</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#0000FF'>const</font> <font color='#5555FF'>&amp;</font> <b>{</b> <font color='#0000FF'>return</font> m_args; <b>}</b>
    <font color='#0000FF'>const</font> dict <font color='#5555FF'>&amp;</font><font color='#BB00BB'>kwargs</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#0000FF'>const</font> <font color='#5555FF'>&amp;</font> <b>{</b> <font color='#0000FF'>return</font> m_kwargs; <b>}</b>

    tuple <font color='#BB00BB'>args</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <b>{</b> <font color='#0000FF'>return</font> std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font>m_args<font face='Lucida Console'>)</font>; <b>}</b>
    dict <font color='#BB00BB'>kwargs</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> <b>{</b> <font color='#0000FF'>return</font> std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font>m_kwargs<font face='Lucida Console'>)</font>; <b>}</b>

    <font color='#009900'>/// Call a Python function and pass the collected arguments
</font>    object <font color='#BB00BB'>call</font><font face='Lucida Console'>(</font>PyObject <font color='#5555FF'>*</font>ptr<font face='Lucida Console'>)</font> <font color='#0000FF'>const</font> <b>{</b>
        PyObject <font color='#5555FF'>*</font>result <font color='#5555FF'>=</font> <font color='#BB00BB'>PyObject_Call</font><font face='Lucida Console'>(</font>ptr, m_args.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>, m_kwargs.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>result<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>throw</font> <font color='#BB00BB'>error_already_set</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
        <b>}</b>
        <font color='#0000FF'>return</font> reinterpret_steal<font color='#5555FF'>&lt;</font>object<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>result<font face='Lucida Console'>)</font>;
    <b>}</b>

<font color='#0000FF'>private</font>:
    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
    <font color='#0000FF'><u>void</u></font> <font color='#BB00BB'>process</font><font face='Lucida Console'>(</font>list <font color='#5555FF'>&amp;</font>args_list, T <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>x<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>auto</font> o <font color='#5555FF'>=</font> reinterpret_steal<font color='#5555FF'>&lt;</font>object<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>
            detail::make_caster<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font>::<font color='#BB00BB'>cast</font><font face='Lucida Console'>(</font>std::forward<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>x<font face='Lucida Console'>)</font>, policy, <b>{</b><b>}</b><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>o<font face='Lucida Console'>)</font> <b>{</b>
<font color='#0000FF'>#if</font> <font color='#5555FF'>!</font>defined<font face='Lucida Console'>(</font>PYBIND11_DETAILED_ERROR_MESSAGES<font face='Lucida Console'>)</font>
            <font color='#0000FF'>throw</font> <font color='#BB00BB'>cast_error_unable_to_convert_call_arg</font><font face='Lucida Console'>(</font>std::<font color='#BB00BB'>to_string</font><font face='Lucida Console'>(</font>args_list.<font color='#BB00BB'>size</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
<font color='#0000FF'>#else</font>
            <font color='#0000FF'>throw</font> <font color='#BB00BB'>cast_error_unable_to_convert_call_arg</font><font face='Lucida Console'>(</font>std::<font color='#BB00BB'>to_string</font><font face='Lucida Console'>(</font>args_list.<font color='#BB00BB'>size</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>,
                                                        type_id<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
<font color='#0000FF'>#endif</font>
        <b>}</b>
        args_list.<font color='#BB00BB'>append</font><font face='Lucida Console'>(</font>std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font>o<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
    <b>}</b>

    <font color='#0000FF'><u>void</u></font> <font color='#BB00BB'>process</font><font face='Lucida Console'>(</font>list <font color='#5555FF'>&amp;</font>args_list, detail::args_proxy ap<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>for</font> <font face='Lucida Console'>(</font><font color='#0000FF'>auto</font> a : ap<font face='Lucida Console'>)</font> <b>{</b>
            args_list.<font color='#BB00BB'>append</font><font face='Lucida Console'>(</font>a<font face='Lucida Console'>)</font>;
        <b>}</b>
    <b>}</b>

    <font color='#0000FF'><u>void</u></font> <font color='#BB00BB'>process</font><font face='Lucida Console'>(</font>list <font color='#5555FF'>&amp;</font> <font color='#009900'>/*args_list*/</font>, arg_v a<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>a.name<font face='Lucida Console'>)</font> <b>{</b>
<font color='#0000FF'>#if</font> <font color='#5555FF'>!</font>defined<font face='Lucida Console'>(</font>PYBIND11_DETAILED_ERROR_MESSAGES<font face='Lucida Console'>)</font>
            <font color='#BB00BB'>nameless_argument_error</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
<font color='#0000FF'>#else</font>
            <font color='#BB00BB'>nameless_argument_error</font><font face='Lucida Console'>(</font>a.type<font face='Lucida Console'>)</font>;
<font color='#0000FF'>#endif</font>
        <b>}</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>m_kwargs.<font color='#BB00BB'>contains</font><font face='Lucida Console'>(</font>a.name<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
<font color='#0000FF'>#if</font> <font color='#5555FF'>!</font>defined<font face='Lucida Console'>(</font>PYBIND11_DETAILED_ERROR_MESSAGES<font face='Lucida Console'>)</font>
            <font color='#BB00BB'>multiple_values_error</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
<font color='#0000FF'>#else</font>
            <font color='#BB00BB'>multiple_values_error</font><font face='Lucida Console'>(</font>a.name<font face='Lucida Console'>)</font>;
<font color='#0000FF'>#endif</font>
        <b>}</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>a.value<font face='Lucida Console'>)</font> <b>{</b>
<font color='#0000FF'>#if</font> <font color='#5555FF'>!</font>defined<font face='Lucida Console'>(</font>PYBIND11_DETAILED_ERROR_MESSAGES<font face='Lucida Console'>)</font>
            <font color='#0000FF'>throw</font> <font color='#BB00BB'>cast_error_unable_to_convert_call_arg</font><font face='Lucida Console'>(</font>a.name<font face='Lucida Console'>)</font>;
<font color='#0000FF'>#else</font>
            <font color='#0000FF'>throw</font> <font color='#BB00BB'>cast_error_unable_to_convert_call_arg</font><font face='Lucida Console'>(</font>a.name, a.type<font face='Lucida Console'>)</font>;
<font color='#0000FF'>#endif</font>
        <b>}</b>
        m_kwargs[a.name] <font color='#5555FF'>=</font> std::<font color='#BB00BB'>move</font><font face='Lucida Console'>(</font>a.value<font face='Lucida Console'>)</font>;
    <b>}</b>

    <font color='#0000FF'><u>void</u></font> <font color='#BB00BB'>process</font><font face='Lucida Console'>(</font>list <font color='#5555FF'>&amp;</font> <font color='#009900'>/*args_list*/</font>, detail::kwargs_proxy kp<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font>kp<font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>return</font>;
        <b>}</b>
        <font color='#0000FF'>for</font> <font face='Lucida Console'>(</font><font color='#0000FF'>auto</font> k : reinterpret_borrow<font color='#5555FF'>&lt;</font>dict<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>kp<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
            <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font>m_kwargs.<font color='#BB00BB'>contains</font><font face='Lucida Console'>(</font>k.first<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
<font color='#0000FF'>#if</font> <font color='#5555FF'>!</font>defined<font face='Lucida Console'>(</font>PYBIND11_DETAILED_ERROR_MESSAGES<font face='Lucida Console'>)</font>
                <font color='#BB00BB'>multiple_values_error</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>;
<font color='#0000FF'>#else</font>
                <font color='#BB00BB'>multiple_values_error</font><font face='Lucida Console'>(</font><font color='#BB00BB'>str</font><font face='Lucida Console'>(</font>k.first<font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
<font color='#0000FF'>#endif</font>
            <b>}</b>
            m_kwargs[k.first] <font color='#5555FF'>=</font> k.second;
        <b>}</b>
    <b>}</b>

    [[noreturn]] <font color='#0000FF'>static</font> <font color='#0000FF'><u>void</u></font> <font color='#BB00BB'>nameless_argument_error</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>throw</font> <font color='#BB00BB'>type_error</font><font face='Lucida Console'>(</font>
            "<font color='#CC0000'>Got kwargs without a name; only named arguments </font>"
            "<font color='#CC0000'>may be passed via py::arg() to a python function call. </font>"
            "<font color='#CC0000'>(#define PYBIND11_DETAILED_ERROR_MESSAGES or compile in debug mode for details)</font>"<font face='Lucida Console'>)</font>;
    <b>}</b>
    [[noreturn]] <font color='#0000FF'>static</font> <font color='#0000FF'><u>void</u></font> <font color='#BB00BB'>nameless_argument_error</font><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> std::string <font color='#5555FF'>&amp;</font>type<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>throw</font> <font color='#BB00BB'>type_error</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Got kwargs without a name of type '</font>" <font color='#5555FF'>+</font> type
                         <font color='#5555FF'>+</font> "<font color='#CC0000'>'; only named </font>"
                           "<font color='#CC0000'>arguments may be passed via py::arg() to a python function call. </font>"<font face='Lucida Console'>)</font>;
    <b>}</b>
    [[noreturn]] <font color='#0000FF'>static</font> <font color='#0000FF'><u>void</u></font> <font color='#BB00BB'>multiple_values_error</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>throw</font> <font color='#BB00BB'>type_error</font><font face='Lucida Console'>(</font>
            "<font color='#CC0000'>Got multiple values for keyword argument </font>"
            "<font color='#CC0000'>(#define PYBIND11_DETAILED_ERROR_MESSAGES or compile in debug mode for details)</font>"<font face='Lucida Console'>)</font>;
    <b>}</b>

    [[noreturn]] <font color='#0000FF'>static</font> <font color='#0000FF'><u>void</u></font> <font color='#BB00BB'>multiple_values_error</font><font face='Lucida Console'>(</font><font color='#0000FF'>const</font> std::string <font color='#5555FF'>&amp;</font>name<font face='Lucida Console'>)</font> <b>{</b>
        <font color='#0000FF'>throw</font> <font color='#BB00BB'>type_error</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>Got multiple values for keyword argument '</font>" <font color='#5555FF'>+</font> name <font color='#5555FF'>+</font> "<font color='#CC0000'>'</font>"<font face='Lucida Console'>)</font>;
    <b>}</b>

<font color='#0000FF'>private</font>:
    tuple m_args;
    dict m_kwargs;
<b>}</b>;

<font color='#009900'>// [workaround(intel)] Separate function required here
</font><font color='#009900'>// We need to put this into a separate function because the Intel compiler
</font><font color='#009900'>// fails to compile enable_if_t&lt;!all_of&lt;is_positional&lt;Args&gt;...&gt;::value&gt;
</font><font color='#009900'>// (tested with ICC 2021.1 Beta 20200827).
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font>... Args<font color='#5555FF'>&gt;</font>
constexpr <font color='#0000FF'><u>bool</u></font> <font color='#BB00BB'>args_are_all_positional</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>return</font> all_of<font color='#5555FF'>&lt;</font>is_positional<font color='#5555FF'>&lt;</font>Args<font color='#5555FF'>&gt;</font>...<font color='#5555FF'>&gt;</font>::value;
<b>}</b>

<font color='#009900'>/// Collect only positional arguments for a Python function call
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font>return_value_policy policy,
          <font color='#0000FF'>typename</font>... Args,
          <font color='#0000FF'>typename</font> <font color='#5555FF'>=</font> enable_if_t<font color='#5555FF'>&lt;</font>args_are_all_positional<font color='#5555FF'>&lt;</font>Args...<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>
simple_collector<font color='#5555FF'>&lt;</font>policy<font color='#5555FF'>&gt;</font> <font color='#BB00BB'>collect_arguments</font><font face='Lucida Console'>(</font>Args <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>...args<font face='Lucida Console'>)</font> <b>{</b>
    <font color='#0000FF'>return</font> simple_collector<font color='#5555FF'>&lt;</font>policy<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>std::forward<font color='#5555FF'>&lt;</font>Args<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>args<font face='Lucida Console'>)</font>...<font face='Lucida Console'>)</font>;
<b>}</b>

<font color='#009900'>/// Collect all arguments, including keywords and unpacking (only instantiated when needed)
</font><font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font>return_value_policy policy,
          <font color='#0000FF'>typename</font>... Args,
          <font color='#0000FF'>typename</font> <font color='#5555FF'>=</font> enable_if_t<font color='#5555FF'>&lt;</font><font color='#5555FF'>!</font>args_are_all_positional<font color='#5555FF'>&lt;</font>Args...<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>
unpacking_collector<font color='#5555FF'>&lt;</font>policy<font color='#5555FF'>&gt;</font> <font color='#BB00BB'>collect_arguments</font><font face='Lucida Console'>(</font>Args <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>...args<font face='Lucida Console'>)</font> <b>{</b>
    <font color='#009900'>// Following argument order rules for generalized unpacking according to PEP 448
</font>    <font color='#BB00BB'>static_assert</font><font face='Lucida Console'>(</font>constexpr_last<font color='#5555FF'>&lt;</font>is_positional, Args...<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>
                          <font color='#5555FF'>&lt;</font> constexpr_first<font color='#5555FF'>&lt;</font>is_keyword_or_ds, Args...<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>
                      <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font> constexpr_last<font color='#5555FF'>&lt;</font>is_s_unpacking, Args...<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>
                             <font color='#5555FF'>&lt;</font> constexpr_first<font color='#5555FF'>&lt;</font>is_ds_unpacking, Args...<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>,
                  "<font color='#CC0000'>Invalid function call: positional args must precede keywords and ** unpacking; </font>"
                  "<font color='#CC0000'>* unpacking must precede ** unpacking</font>"<font face='Lucida Console'>)</font>;
    <font color='#0000FF'>return</font> unpacking_collector<font color='#5555FF'>&lt;</font>policy<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>std::forward<font color='#5555FF'>&lt;</font>Args<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>args<font face='Lucida Console'>)</font>...<font face='Lucida Console'>)</font>;
<b>}</b>

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> Derived<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font>return_value_policy policy, <font color='#0000FF'>typename</font>... Args<font color='#5555FF'>&gt;</font>
object object_api<font color='#5555FF'>&lt;</font>Derived<font color='#5555FF'>&gt;</font>::<b><a name='operator'></a>operator</b><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>(</font>Args <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>...args<font face='Lucida Console'>)</font> <font color='#0000FF'>const</font> <b>{</b>
<font color='#0000FF'>#ifndef</font> NDEBUG
    <font color='#0000FF'>if</font> <font face='Lucida Console'>(</font><font color='#5555FF'>!</font><font color='#BB00BB'>PyGILState_Check</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font> <b>{</b>
        <font color='#BB00BB'>pybind11_fail</font><font face='Lucida Console'>(</font>"<font color='#CC0000'>pybind11::object_api&lt;&gt;::operator() PyGILState_Check() failure.</font>"<font face='Lucida Console'>)</font>;
    <b>}</b>
<font color='#0000FF'>#endif</font>
    <font color='#0000FF'>return</font> detail::collect_arguments<font color='#5555FF'>&lt;</font>policy<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>std::forward<font color='#5555FF'>&lt;</font>Args<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>args<font face='Lucida Console'>)</font>...<font face='Lucida Console'>)</font>.<font color='#BB00BB'>call</font><font face='Lucida Console'>(</font><font color='#BB00BB'>derived</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font>.<font color='#BB00BB'>ptr</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font face='Lucida Console'>)</font>;
<b>}</b>

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> Derived<font color='#5555FF'>&gt;</font>
<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font>return_value_policy policy, <font color='#0000FF'>typename</font>... Args<font color='#5555FF'>&gt;</font>
object object_api<font color='#5555FF'>&lt;</font>Derived<font color='#5555FF'>&gt;</font>::<font color='#BB00BB'>call</font><font face='Lucida Console'>(</font>Args <font color='#5555FF'>&amp;</font><font color='#5555FF'>&amp;</font>...args<font face='Lucida Console'>)</font> <font color='#0000FF'>const</font> <b>{</b>
    <font color='#0000FF'>return</font> <font color='#0000FF'>operator</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font><font color='#5555FF'>&lt;</font>policy<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>std::forward<font color='#5555FF'>&lt;</font>Args<font color='#5555FF'>&gt;</font><font face='Lucida Console'>(</font>args<font face='Lucida Console'>)</font>...<font face='Lucida Console'>)</font>;
<b>}</b>

<font color='#BB00BB'>PYBIND11_NAMESPACE_END</font><font face='Lucida Console'>(</font>detail<font face='Lucida Console'>)</font>

<font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#0000FF'>typename</font> T<font color='#5555FF'>&gt;</font>
handle type::<font color='#BB00BB'>handle_of</font><font face='Lucida Console'>(</font><font face='Lucida Console'>)</font> <b>{</b>
    <font color='#BB00BB'>static_assert</font><font face='Lucida Console'>(</font>std::is_base_of<font color='#5555FF'>&lt;</font>detail::type_caster_generic, detail::make_caster<font color='#5555FF'>&lt;</font>T<font color='#5555FF'>&gt;</font><font color='#5555FF'>&gt;</font>::value,
                  "<font color='#CC0000'>py::type::of&lt;T&gt; only supports the case where T is a registered C++ types.</font>"<font face='Lucida Console'>)</font>;

    <font color='#0000FF'>return</font> detail::<font color='#BB00BB'>get_type_handle</font><font face='Lucida Console'>(</font><font color='#0000FF'>typeid</font><font face='Lucida Console'>(</font>T<font face='Lucida Console'>)</font>, <font color='#979000'>true</font><font face='Lucida Console'>)</font>;
<b>}</b>

<font color='#0000FF'>#define</font> PYBIND11_MAKE_OPAQUE<font face='Lucida Console'>(</font>...<font face='Lucida Console'>)</font>                                                                 \
    <font color='#BB00BB'>PYBIND11_NAMESPACE_BEGIN</font><font face='Lucida Console'>(</font>PYBIND11_NAMESPACE<font face='Lucida Console'>)</font>                                                  \
    <font color='#0000FF'>namespace</font> detail <b>{</b>                                                                            \
    <font color='#0000FF'>template</font> <font color='#5555FF'>&lt;</font><font color='#5555FF'>&gt;</font>                                                                                   \
    <font color='#0000FF'>class</font> <b><a name='type_caster'></a>type_caster</b><font color='#5555FF'>&lt;</font>__VA_ARGS__<font color='#5555FF'>&gt;</font> : <font color='#0000FF'>public</font> type_caster_base<font color='#5555FF'>&lt;</font>__VA_ARGS__<font color='#5555FF'>&gt;</font> <b>{</b><b>}</b>;                     \
    <b>}</b>                                                                                             \
    <font color='#BB00BB'>PYBIND11_NAMESPACE_END</font><font face='Lucida Console'>(</font>PYBIND11_NAMESPACE<font face='Lucida Console'>)</font>

<font color='#009900'>/// Lets you pass a type containing a `,` through a macro parameter without needing a separate
</font><font color='#009900'>/// typedef, e.g.:
</font><font color='#009900'>/// `PYBIND11_OVERRIDE(PYBIND11_TYPE(ReturnType&lt;A, B&gt;), PYBIND11_TYPE(Parent&lt;C, D&gt;), f, arg)`
</font><font color='#0000FF'>#define</font> PYBIND11_TYPE<font face='Lucida Console'>(</font>...<font face='Lucida Console'>)</font> __VA_ARGS__

<font color='#BB00BB'>PYBIND11_NAMESPACE_END</font><font face='Lucida Console'>(</font>PYBIND11_NAMESPACE<font face='Lucida Console'>)</font>

</pre></body></html>